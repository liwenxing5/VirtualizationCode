#! /bin/sh
# Generated from system-dpdk-testsuite.at by GNU Autoconf 2.71.
#
# Copyright (C) 2009-2017, 2020-2021 Free Software Foundation, Inc.
#
# This test suite is free software; the Free Software Foundation gives
# unlimited permission to copy, distribute and modify it.
#
# Copyright (c) 2017 Intel Corporation
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at:
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
## -------------------- ##
## M4sh Initialization. ##
## -------------------- ##

# Be more Bourne compatible
DUALCASE=1; export DUALCASE # for MKS sh
as_nop=:
if test ${ZSH_VERSION+y} && (emulate sh) >/dev/null 2>&1
then :
  emulate sh
  NULLCMD=:
  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
  # is contrary to our usage.  Disable this feature.
  alias -g '${1+"$@"}'='"$@"'
  setopt NO_GLOB_SUBST
else $as_nop
  case `(set -o) 2>/dev/null` in #(
  *posix*) :
    set -o posix ;; #(
  *) :
     ;;
esac
fi



# Reset variables that may have inherited troublesome values from
# the environment.

# IFS needs to be set, to space, tab, and newline, in precisely that order.
# (If _AS_PATH_WALK were called with IFS unset, it would have the
# side effect of setting IFS to empty, thus disabling word splitting.)
# Quoting is to prevent editors from complaining about space-tab.
as_nl='
'
export as_nl
IFS=" ""	$as_nl"

PS1='$ '
PS2='> '
PS4='+ '

# Ensure predictable behavior from utilities with locale-dependent output.
LC_ALL=C
export LC_ALL
LANGUAGE=C
export LANGUAGE

# We cannot yet rely on "unset" to work, but we need these variables
# to be unset--not just set to an empty or harmless value--now, to
# avoid bugs in old shells (e.g. pre-3.0 UWIN ksh).  This construct
# also avoids known problems related to "unset" and subshell syntax
# in other old shells (e.g. bash 2.01 and pdksh 5.2.14).
for as_var in BASH_ENV ENV MAIL MAILPATH CDPATH
do eval test \${$as_var+y} \
  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
done

# Ensure that fds 0, 1, and 2 are open.
if (exec 3>&0) 2>/dev/null; then :; else exec 0</dev/null; fi
if (exec 3>&1) 2>/dev/null; then :; else exec 1>/dev/null; fi
if (exec 3>&2)            ; then :; else exec 2>/dev/null; fi

# The user is always right.
if ${PATH_SEPARATOR+false} :; then
  PATH_SEPARATOR=:
  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
      PATH_SEPARATOR=';'
  }
fi


# Find who we are.  Look in the path if we contain no directory separator.
as_myself=
case $0 in #((
  *[\\/]* ) as_myself=$0 ;;
  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  case $as_dir in #(((
    '') as_dir=./ ;;
    */) ;;
    *) as_dir=$as_dir/ ;;
  esac
    test -r "$as_dir$0" && as_myself=$as_dir$0 && break
  done
IFS=$as_save_IFS

     ;;
esac
# We did not find ourselves, most probably we were run as `sh COMMAND'
# in which case we are not to be found in the path.
if test "x$as_myself" = x; then
  as_myself=$0
fi
if test ! -f "$as_myself"; then
  printf "%s\n" "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
  exit 1
fi


if test "x$CONFIG_SHELL" = x; then
  as_bourne_compatible="as_nop=:
if test \${ZSH_VERSION+y} && (emulate sh) >/dev/null 2>&1
then :
  emulate sh
  NULLCMD=:
  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
  # is contrary to our usage.  Disable this feature.
  alias -g '\${1+\"\$@\"}'='\"\$@\"'
  setopt NO_GLOB_SUBST
else \$as_nop
  case \`(set -o) 2>/dev/null\` in #(
  *posix*) :
    set -o posix ;; #(
  *) :
     ;;
esac
fi
"
  as_required="as_fn_return () { (exit \$1); }
as_fn_success () { as_fn_return 0; }
as_fn_failure () { as_fn_return 1; }
as_fn_ret_success () { return 0; }
as_fn_ret_failure () { return 1; }

exitcode=0
as_fn_success || { exitcode=1; echo as_fn_success failed.; }
as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
if ( set x; as_fn_ret_success y && test x = \"\$1\" )
then :

else \$as_nop
  exitcode=1; echo positional parameters were not saved.
fi
test x\$exitcode = x0 || exit 1
blah=\$(echo \$(echo blah))
test x\"\$blah\" = xblah || exit 1
test -x / || exit 1"
  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
test \$(( 1 + 1 )) = 2 || exit 1"
  if (eval "$as_required") 2>/dev/null
then :
  as_have_required=yes
else $as_nop
  as_have_required=no
fi
  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null
then :

else $as_nop
  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
as_found=false
for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
do
  IFS=$as_save_IFS
  case $as_dir in #(((
    '') as_dir=./ ;;
    */) ;;
    *) as_dir=$as_dir/ ;;
  esac
  as_found=:
  case $as_dir in #(
	 /*)
	   for as_base in sh bash ksh sh5; do
	     # Try only shells that exist, to save several forks.
	     as_shell=$as_dir$as_base
	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
		    as_run=a "$as_shell" -c "$as_bourne_compatible""$as_required" 2>/dev/null
then :
  CONFIG_SHELL=$as_shell as_have_required=yes
		   if as_run=a "$as_shell" -c "$as_bourne_compatible""$as_suggested" 2>/dev/null
then :
  break 2
fi
fi
	   done;;
       esac
  as_found=false
done
IFS=$as_save_IFS
if $as_found
then :

else $as_nop
  if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
	      as_run=a "$SHELL" -c "$as_bourne_compatible""$as_required" 2>/dev/null
then :
  CONFIG_SHELL=$SHELL as_have_required=yes
fi
fi


      if test "x$CONFIG_SHELL" != x
then :
  export CONFIG_SHELL
             # We cannot yet assume a decent shell, so we have to provide a
# neutralization value for shells without unset; and this also
# works around shells that cannot unset nonexistent variables.
# Preserve -v and -x to the replacement shell.
BASH_ENV=/dev/null
ENV=/dev/null
(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
case $- in # ((((
  *v*x* | *x*v* ) as_opts=-vx ;;
  *v* ) as_opts=-v ;;
  *x* ) as_opts=-x ;;
  * ) as_opts= ;;
esac
exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
# Admittedly, this is quite paranoid, since all the known shells bail
# out after a failed `exec'.
printf "%s\n" "$0: could not re-execute with $CONFIG_SHELL" >&2
exit 255
fi

    if test x$as_have_required = xno
then :
  printf "%s\n" "$0: This script requires a shell more modern than all"
  printf "%s\n" "$0: the shells that I found on your system."
  if test ${ZSH_VERSION+y} ; then
    printf "%s\n" "$0: In particular, zsh $ZSH_VERSION has bugs and should"
    printf "%s\n" "$0: be upgraded to zsh 4.3.4 or later."
  else
    printf "%s\n" "$0: Please tell bug-autoconf@gnu.org about your system,
$0: including any error possibly output before this
$0: message. Then install a modern shell, or manually run
$0: the script under such a shell if you do have one."
  fi
  exit 1
fi
fi
fi
SHELL=${CONFIG_SHELL-/bin/sh}
export SHELL
# Unset more variables known to interfere with behavior of common tools.
CLICOLOR_FORCE= GREP_OPTIONS=
unset CLICOLOR_FORCE GREP_OPTIONS

## --------------------- ##
## M4sh Shell Functions. ##
## --------------------- ##
# as_fn_unset VAR
# ---------------
# Portably unset VAR.
as_fn_unset ()
{
  { eval $1=; unset $1;}
}
as_unset=as_fn_unset


# as_fn_set_status STATUS
# -----------------------
# Set $? to STATUS, without forking.
as_fn_set_status ()
{
  return $1
} # as_fn_set_status

# as_fn_exit STATUS
# -----------------
# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
as_fn_exit ()
{
  set +e
  as_fn_set_status $1
  exit $1
} # as_fn_exit
# as_fn_nop
# ---------
# Do nothing but, unlike ":", preserve the value of $?.
as_fn_nop ()
{
  return $?
}
as_nop=as_fn_nop

# as_fn_mkdir_p
# -------------
# Create "$as_dir" as a directory, including parents if necessary.
as_fn_mkdir_p ()
{

  case $as_dir in #(
  -*) as_dir=./$as_dir;;
  esac
  test -d "$as_dir" || eval $as_mkdir_p || {
    as_dirs=
    while :; do
      case $as_dir in #(
      *\'*) as_qdir=`printf "%s\n" "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
      *) as_qdir=$as_dir;;
      esac
      as_dirs="'$as_qdir' $as_dirs"
      as_dir=`$as_dirname -- "$as_dir" ||
$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
	 X"$as_dir" : 'X\(//\)[^/]' \| \
	 X"$as_dir" : 'X\(//\)$' \| \
	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
printf "%s\n" X"$as_dir" |
    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
	    s//\1/
	    q
	  }
	  /^X\(\/\/\)[^/].*/{
	    s//\1/
	    q
	  }
	  /^X\(\/\/\)$/{
	    s//\1/
	    q
	  }
	  /^X\(\/\).*/{
	    s//\1/
	    q
	  }
	  s/.*/./; q'`
      test -d "$as_dir" && break
    done
    test -z "$as_dirs" || eval "mkdir $as_dirs"
  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"


} # as_fn_mkdir_p

# as_fn_executable_p FILE
# -----------------------
# Test if FILE is an executable regular file.
as_fn_executable_p ()
{
  test -f "$1" && test -x "$1"
} # as_fn_executable_p
# as_fn_append VAR VALUE
# ----------------------
# Append the text in VALUE to the end of the definition contained in VAR. Take
# advantage of any shell optimizations that allow amortized linear growth over
# repeated appends, instead of the typical quadratic growth present in naive
# implementations.
if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null
then :
  eval 'as_fn_append ()
  {
    eval $1+=\$2
  }'
else $as_nop
  as_fn_append ()
  {
    eval $1=\$$1\$2
  }
fi # as_fn_append

# as_fn_arith ARG...
# ------------------
# Perform arithmetic evaluation on the ARGs, and store the result in the
# global $as_val. Take advantage of shells that can avoid forks. The arguments
# must be portable across $(()) and expr.
if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null
then :
  eval 'as_fn_arith ()
  {
    as_val=$(( $* ))
  }'
else $as_nop
  as_fn_arith ()
  {
    as_val=`expr "$@" || test $? -eq 1`
  }
fi # as_fn_arith


# as_fn_error STATUS ERROR [LINENO LOG_FD]
# ----------------------------------------
# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
# script with STATUS, using 1 if that was 0.
as_fn_error ()
{
  as_status=$1; test $as_status -eq 0 && as_status=1
  if test "$4"; then
    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
    printf "%s\n" "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
  fi
  printf "%s\n" "$as_me: error: $2" >&2
  as_fn_exit $as_status
} # as_fn_error

if expr a : '\(a\)' >/dev/null 2>&1 &&
   test "X`expr 00001 : '.*\(...\)'`" = X001; then
  as_expr=expr
else
  as_expr=false
fi

if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
  as_basename=basename
else
  as_basename=false
fi

as_me=`$as_basename -- "$0" ||
$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
	 X"$0" : 'X\(//\)$' \| \
	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
printf "%s\n" X/"$0" |
    sed '/^.*\/\([^/][^/]*\)\/*$/{
	    s//\1/
	    q
	  }
	  /^X\/\(\/\/\)$/{
	    s//\1/
	    q
	  }
	  /^X\/\(\/\).*/{
	    s//\1/
	    q
	  }
	  s/.*/./; q'`

if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
  as_dirname=dirname
else
  as_dirname=false
fi

# Avoid depending upon Character Ranges.
as_cr_letters='abcdefghijklmnopqrstuvwxyz'
as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
as_cr_Letters=$as_cr_letters$as_cr_LETTERS
as_cr_digits='0123456789'
as_cr_alnum=$as_cr_Letters$as_cr_digits


  as_lineno_1=$LINENO as_lineno_1a=$LINENO
  as_lineno_2=$LINENO as_lineno_2a=$LINENO
  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
  sed -n '
    p
    /[$]LINENO/=
  ' <$as_myself |
    sed '
      s/[$]LINENO.*/&-/
      t lineno
      b
      :lineno
      N
      :loop
      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
      t loop
      s/-\n.*//
    ' >$as_me.lineno &&
  chmod +x "$as_me.lineno" ||
    { printf "%s\n" "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }

  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
  # already done that, so ensure we don't try to do so again and fall
  # in an infinite loop.  This has already happened in practice.
  _as_can_reexec=no; export _as_can_reexec
  # Don't try to exec as it changes $[0], causing all sort of problems
  # (the dirname of $[0] is not the place where we might find the
  # original and so on.  Autoconf is especially sensitive to this).
  . "./$as_me.lineno"
  # Exit status is that of the last command.
  exit
}


# Determine whether it's possible to make 'echo' print without a newline.
# These variables are no longer used directly by Autoconf, but are AC_SUBSTed
# for compatibility with existing Makefiles.
ECHO_C= ECHO_N= ECHO_T=
case `echo -n x` in #(((((
-n*)
  case `echo 'xy\c'` in
  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
  xy)  ECHO_C='\c';;
  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
       ECHO_T='	';;
  esac;;
*)
  ECHO_N='-n';;
esac

# For backward compatibility with old third-party macros, we provide
# the shell variables $as_echo and $as_echo_n.  New code should use
# AS_ECHO(["message"]) and AS_ECHO_N(["message"]), respectively.
as_echo='printf %s\n'
as_echo_n='printf %s'


rm -f conf$$ conf$$.exe conf$$.file
if test -d conf$$.dir; then
  rm -f conf$$.dir/conf$$.file
else
  rm -f conf$$.dir
  mkdir conf$$.dir 2>/dev/null
fi
if (echo >conf$$.file) 2>/dev/null; then
  if ln -s conf$$.file conf$$ 2>/dev/null; then
    as_ln_s='ln -s'
    # ... but there are two gotchas:
    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
    # In both cases, we have to default to `cp -pR'.
    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
      as_ln_s='cp -pR'
  elif ln conf$$.file conf$$ 2>/dev/null; then
    as_ln_s=ln
  else
    as_ln_s='cp -pR'
  fi
else
  as_ln_s='cp -pR'
fi
rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
rmdir conf$$.dir 2>/dev/null

if mkdir -p . 2>/dev/null; then
  as_mkdir_p='mkdir -p "$as_dir"'
else
  test -d ./-p && rmdir ./-p
  as_mkdir_p=false
fi

as_test_x='test -x'
as_executable_p=as_fn_executable_p

# Sed expression to map a string onto a valid CPP name.
as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"

# Sed expression to map a string onto a valid variable name.
as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"





SHELL=${CONFIG_SHELL-/bin/sh}

# How were we run?
at_cli_args="$@"


# Not all shells have the 'times' builtin; the subshell is needed to make
# sure we discard the 'times: not found' message from the shell.
at_times_p=false
(times) >/dev/null 2>&1 && at_times_p=:

# CLI Arguments to pass to the debugging scripts.
at_debug_args=
# -e sets to true
at_errexit_p=false
# Shall we be verbose?  ':' means no, empty means yes.
at_verbose=:
at_quiet=
# Running several jobs in parallel, 0 means as many as test groups.
at_jobs=1
at_traceon=:
at_trace_echo=:
at_check_filter_trace=:

# Shall we keep the debug scripts?  Must be `:' when the suite is
# run by a debug script, so that the script doesn't remove itself.
at_debug_p=false
# Display help message?
at_help_p=false
# Display the version message?
at_version_p=false
# List test groups?
at_list_p=false
# --clean
at_clean=false
# Test groups to run
at_groups=
# Whether to rerun failed tests.
at_recheck=
# Whether a write failure occurred
at_write_fail=0

# The directory we run the suite in.  Default to . if no -C option.
at_dir=`pwd`
# An absolute reference to this testsuite script.
case $as_myself in
  [\\/]* | ?:[\\/]* ) at_myself=$as_myself ;;
  * ) at_myself=$at_dir/$as_myself ;;
esac
# Whether -C is in effect.
at_change_dir=false

# Whether to enable colored test results.
at_color=auto
# As many question marks as there are digits in the last test group number.
# Used to normalize the test group numbers so that `ls' lists them in
# numerical order.
at_format='??'
# Description of all the test groups.
at_help_all="1;system-dpdk.at:32;OVS-DPDK - EAL init;dpdk;
2;system-dpdk.at:47;OVS-DPDK - add standard DPDK port;dpdk;
3;system-dpdk.at:69;OVS-DPDK - add vhost-user-client port;dpdk;
4;system-dpdk.at:97;OVS-DPDK - ping vhost-user ports;dpdk;
5;system-dpdk.at:173;OVS-DPDK - ping vhost-user-client ports;dpdk;
6;system-dpdk.at:272;OVS-DPDK - Ingress policing create delete phy port;dpdk;
7;system-dpdk.at:308;OVS-DPDK - Ingress policing create delete vport port;dpdk;
8;system-dpdk.at:351;OVS-DPDK - Ingress policing no policing rate;dpdk;
9;system-dpdk.at:392;OVS-DPDK - Ingress policing no policing burst;dpdk;
10;system-dpdk.at:431;OVS-DPDK - QoS create delete phy port;dpdk;
11;system-dpdk.at:464;OVS-DPDK - QoS create delete vport port;dpdk;
12;system-dpdk.at:505;OVS-DPDK - QoS no cir;dpdk;
13;system-dpdk.at:540;OVS-DPDK - QoS no cbs;dpdk;
14;system-dpdk.at:576;OVS-DPDK - MTU increase phy port;dpdk;
15;system-dpdk.at:617;OVS-DPDK - MTU decrease phy port;dpdk;
16;system-dpdk.at:659;OVS-DPDK - MTU increase vport port;dpdk;
17;system-dpdk.at:715;OVS-DPDK - MTU decrease vport port;dpdk;
18;system-dpdk.at:772;OVS-DPDK - MTU upper bound phy port;dpdk;
19;system-dpdk.at:813;OVS-DPDK - MTU lower bound phy port;dpdk;
20;system-dpdk.at:854;OVS-DPDK - MTU upper bound vport port;dpdk;
21;system-dpdk.at:906;OVS-DPDK - MTU lower bound vport port;dpdk;
22;system-dpdk.at:963;OVS-DPDK - MFEX Autovalidator;dpdk;
23;system-dpdk.at:996;OVS-DPDK - MFEX Autovalidator Fuzzy;dpdk;
24;system-dpdk.at:1030;OVS-DPDK - MFEX Configuration;dpdk;
25;system-dpdk.at:1152;OVS-DPDK - user configured mempool;dpdk;
"
# List of the all the test groups.
at_groups_all=`printf "%s\n" "$at_help_all" | sed 's/;.*//'`

# at_fn_validate_ranges NAME...
# -----------------------------
# Validate and normalize the test group number contained in each variable
# NAME. Leading zeroes are treated as decimal.
at_fn_validate_ranges ()
{
  for at_grp
  do
    eval at_value=\$$at_grp
    if test $at_value -lt 1 || test $at_value -gt 25; then
      printf "%s\n" "invalid test group: $at_value" >&2
      exit 1
    fi
    case $at_value in
      0*) # We want to treat leading 0 as decimal, like expr and test, but
	  # AS_VAR_ARITH treats it as octal if it uses $(( )).
	  # With XSI shells, ${at_value#${at_value%%[1-9]*}} avoids the
	  # expr fork, but it is not worth the effort to determine if the
	  # shell supports XSI when the user can just avoid leading 0.
	  eval $at_grp='`expr $at_value + 0`' ;;
    esac
  done
}
# List of the tested programs.
at_tested='"ovs-vswitchd"
"ovs-vsctl"'


at_prev=
for at_option
do
  # If the previous option needs an argument, assign it.
  if test -n "$at_prev"; then
    at_option=$at_prev=$at_option
    at_prev=
  fi

  case $at_option in
  *=?*) at_optarg=`expr "X$at_option" : '[^=]*=\(.*\)'` ;;
  *)    at_optarg= ;;
  esac

  case $at_option in
    --help | -h )
	at_help_p=:
	;;

    --list | -l )
	at_list_p=:
	;;

    --version | -V )
	at_version_p=:
	;;

    --clean | -c )
	at_clean=:
	;;

    --color )
	at_color=always
	;;
    --color=* )
	case $at_optarg in
	no | never | none) at_color=never ;;
	auto | tty | if-tty) at_color=auto ;;
	always | yes | force) at_color=always ;;
	*) at_optname=`echo " $at_option" | sed 's/^ //; s/=.*//'`
	   as_fn_error $? "unrecognized argument to $at_optname: $at_optarg" ;;
	esac
	;;

    --debug | -d )
	at_debug_p=:
	;;

    --errexit | -e )
	at_debug_p=:
	at_errexit_p=:
	;;

    --verbose | -v )
	at_verbose=; at_quiet=:
	;;

    --trace | -x )
	at_traceon='set -x'
	at_trace_echo=echo
	at_check_filter_trace=at_fn_filter_trace
	;;

    [0-9] | [0-9][0-9] | [0-9][0-9][0-9] | [0-9][0-9][0-9][0-9])
	at_fn_validate_ranges at_option
	as_fn_append at_groups "$at_option$as_nl"
	;;

    # Ranges
    [0-9]- | [0-9][0-9]- | [0-9][0-9][0-9]- | [0-9][0-9][0-9][0-9]-)
	at_range_start=`echo $at_option |tr -d X-`
	at_fn_validate_ranges at_range_start
	at_range=`printf "%s\n" "$at_groups_all" | \
	  sed -ne '/^'$at_range_start'$/,$p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    -[0-9] | -[0-9][0-9] | -[0-9][0-9][0-9] | -[0-9][0-9][0-9][0-9])
	at_range_end=`echo $at_option |tr -d X-`
	at_fn_validate_ranges at_range_end
	at_range=`printf "%s\n" "$at_groups_all" | \
	  sed -ne '1,/^'$at_range_end'$/p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    [0-9]-[0-9] | [0-9]-[0-9][0-9] | [0-9]-[0-9][0-9][0-9] | \
    [0-9]-[0-9][0-9][0-9][0-9] | [0-9][0-9]-[0-9][0-9] | \
    [0-9][0-9]-[0-9][0-9][0-9] | [0-9][0-9]-[0-9][0-9][0-9][0-9] | \
    [0-9][0-9][0-9]-[0-9][0-9][0-9] | \
    [0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] | \
    [0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] )
	at_range_start=`expr $at_option : '\(.*\)-'`
	at_range_end=`expr $at_option : '.*-\(.*\)'`
	if test $at_range_start -gt $at_range_end; then
	  at_tmp=$at_range_end
	  at_range_end=$at_range_start
	  at_range_start=$at_tmp
	fi
	at_fn_validate_ranges at_range_start at_range_end
	at_range=`printf "%s\n" "$at_groups_all" | \
	  sed -ne '/^'$at_range_start'$/,/^'$at_range_end'$/p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    # Directory selection.
    --directory | -C )
	at_prev=--directory
	;;
    --directory=* )
	at_change_dir=:
	at_dir=$at_optarg
	if test x- = "x$at_dir" ; then
	  at_dir=./-
	fi
	;;

    # Parallel execution.
    --jobs | -j )
	at_jobs=0
	;;
    --jobs=* | -j[0-9]* )
	if test -n "$at_optarg"; then
	  at_jobs=$at_optarg
	else
	  at_jobs=`expr X$at_option : 'X-j\(.*\)'`
	fi
	case $at_jobs in *[!0-9]*)
	  at_optname=`echo " $at_option" | sed 's/^ //; s/[0-9=].*//'`
	  as_fn_error $? "non-numeric argument to $at_optname: $at_jobs" ;;
	esac
	;;

    # Keywords.
    --keywords | -k )
	at_prev=--keywords
	;;
    --keywords=* )
	at_groups_selected=$at_help_all
	at_save_IFS=$IFS
	IFS=,
	set X $at_optarg
	shift
	IFS=$at_save_IFS
	for at_keyword
	do
	  at_invert=
	  case $at_keyword in
	  '!'*)
	    at_invert="-v"
	    at_keyword=`expr "X$at_keyword" : 'X!\(.*\)'`
	    ;;
	  esac
	  # It is on purpose that we match the test group titles too.
	  at_groups_selected=`printf "%s\n" "$at_groups_selected" |
	      grep -i $at_invert "^[1-9][^;]*;.*[; ]$at_keyword[ ;]"`
	done
	# Smash the keywords.
	at_groups_selected=`printf "%s\n" "$at_groups_selected" | sed 's/;.*//'`
	as_fn_append at_groups "$at_groups_selected$as_nl"
	;;
    --recheck)
	at_recheck=:
	;;

    *=*)
	at_envvar=`expr "x$at_option" : 'x\([^=]*\)='`
	# Reject names that are not valid shell variable names.
	case $at_envvar in
	  '' | [0-9]* | *[!_$as_cr_alnum]* )
	    as_fn_error $? "invalid variable name: \`$at_envvar'" ;;
	esac
	at_value=`printf "%s\n" "$at_optarg" | sed "s/'/'\\\\\\\\''/g"`
	# Export now, but save eval for later and for debug scripts.
	export $at_envvar
	as_fn_append at_debug_args " $at_envvar='$at_value'"
	;;

     *) printf "%s\n" "$as_me: invalid option: $at_option" >&2
	printf "%s\n" "Try \`$0 --help' for more information." >&2
	exit 1
	;;
  esac
done

# Verify our last option didn't require an argument
if test -n "$at_prev"
then :
  as_fn_error $? "\`$at_prev' requires an argument"
fi

# The file containing the suite.
at_suite_log=$at_dir/$as_me.log

# Selected test groups.
if test -z "$at_groups$at_recheck"; then
  at_groups=$at_groups_all
else
  if test -n "$at_recheck" && test -r "$at_suite_log"; then
    at_oldfails=`sed -n '
      /^Failed tests:$/,/^Skipped tests:$/{
	s/^[ ]*\([1-9][0-9]*\):.*/\1/p
      }
      /^Unexpected passes:$/,/^## Detailed failed tests/{
	s/^[ ]*\([1-9][0-9]*\):.*/\1/p
      }
      /^## Detailed failed tests/q
      ' "$at_suite_log"`
    as_fn_append at_groups "$at_oldfails$as_nl"
  fi
  # Sort the tests, removing duplicates.
  at_groups=`printf "%s\n" "$at_groups" | sort -nu | sed '/^$/d'`
fi

if test x"$at_color" = xalways \
   || { test x"$at_color" = xauto && test -t 1; }; then
  at_red=`printf '\033[0;31m'`
  at_grn=`printf '\033[0;32m'`
  at_lgn=`printf '\033[1;32m'`
  at_blu=`printf '\033[1;34m'`
  at_std=`printf '\033[m'`
else
  at_red= at_grn= at_lgn= at_blu= at_std=
fi

# Help message.
if $at_help_p; then
  cat <<_ATEOF || at_write_fail=1
Usage: $0 [OPTION]... [VARIABLE=VALUE]... [TESTS]

Run all the tests, or the selected TESTS, given by numeric ranges, and
save a detailed log file.  Upon failure, create debugging scripts.

Do not change environment variables directly.  Instead, set them via
command line arguments.  Set \`AUTOTEST_PATH' to select the executables
to exercise.  Each relative directory is expanded as build and source
directories relative to the top level of this distribution.
E.g., from within the build directory /tmp/foo-1.0, invoking this:

  $ $0 AUTOTEST_PATH=bin

is equivalent to the following, assuming the source directory is /src/foo-1.0:

  PATH=/tmp/foo-1.0/bin:/src/foo-1.0/bin:\$PATH $0
_ATEOF
cat <<_ATEOF || at_write_fail=1

Operation modes:
  -h, --help     print the help message, then exit
  -V, --version  print version number, then exit
  -c, --clean    remove all the files this test suite might create and exit
  -l, --list     describes all the tests, or the selected TESTS
_ATEOF
cat <<_ATEOF || at_write_fail=1

Execution tuning:
  -C, --directory=DIR
                 change to directory DIR before starting
      --color[=never|auto|always]
                 disable colored test results, or enable even without terminal
  -j, --jobs[=N]
                 Allow N jobs at once; infinite jobs with no arg (default 1)
  -k, --keywords=KEYWORDS
                 select the tests matching all the comma-separated KEYWORDS
                 multiple \`-k' accumulate; prefixed \`!' negates a KEYWORD
      --recheck  select all tests that failed or passed unexpectedly last time
  -e, --errexit  abort as soon as a test fails; implies --debug
  -v, --verbose  force more detailed output
                 default for debugging scripts
  -d, --debug    inhibit clean up and top-level logging
                 default for debugging scripts
  -x, --trace    enable tests shell tracing
_ATEOF
cat <<_ATEOF || at_write_fail=1

Report bugs to <bugs@openvswitch.org>.
_ATEOF
  exit $at_write_fail
fi

# List of tests.
if $at_list_p; then
  cat <<_ATEOF || at_write_fail=1
openvswitch 3.1.2 test suite test groups:

 NUM: FILE-NAME:LINE     TEST-GROUP-NAME
      KEYWORDS

_ATEOF
  # Pass an empty line as separator between selected groups and help.
  printf "%s\n" "$at_groups$as_nl$as_nl$at_help_all" |
    awk 'NF == 1 && FS != ";" {
	   selected[$ 1] = 1
	   next
	 }
	 /^$/ { FS = ";" }
	 NF > 0 {
	   if (selected[$ 1]) {
	     printf " %3d: %-18s %s\n", $ 1, $ 2, $ 3
	     if ($ 4) {
	       lmax = 79
	       indent = "     "
	       line = indent
	       len = length (line)
	       n = split ($ 4, a, " ")
	       for (i = 1; i <= n; i++) {
		 l = length (a[i]) + 1
		 if (i > 1 && len + l > lmax) {
		   print line
		   line = indent " " a[i]
		   len = length (line)
		 } else {
		   line = line " " a[i]
		   len += l
		 }
	       }
	       if (n)
		 print line
	     }
	   }
	 }' || at_write_fail=1
  exit $at_write_fail
fi
if $at_version_p; then
  printf "%s\n" "$as_me (openvswitch 3.1.2)" &&
  cat <<\_ATEOF || at_write_fail=1

Copyright (C) 2021 Free Software Foundation, Inc.
This test suite is free software; the Free Software Foundation gives
unlimited permission to copy, distribute and modify it.

Copyright (c) 2017 Intel Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at:

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
_ATEOF
  exit $at_write_fail
fi

# Should we print banners?  Yes if more than one test is run.
case $at_groups in #(
  *$as_nl* )
      at_print_banners=: ;; #(
  * ) at_print_banners=false ;;
esac
# Text for banner N, set to a single space once printed.
# Banner 1. system-dpdk.at:4
# Category starts at test group 1.
at_banner_text_1="OVS-DPDK unit tests"

# Take any -C into account.
if $at_change_dir ; then
  test x != "x$at_dir" && cd "$at_dir" \
    || as_fn_error $? "unable to change directory"
  at_dir=`pwd`
fi

# Load the config files for any default variable assignments.
for at_file in atconfig atlocal
do
  test -r $at_file || continue
  . ./$at_file || as_fn_error $? "invalid content: $at_file"
done

# Autoconf <=2.59b set at_top_builddir instead of at_top_build_prefix:
: "${at_top_build_prefix=$at_top_builddir}"

# Perform any assignments requested during argument parsing.
eval "$at_debug_args"

# atconfig delivers names relative to the directory the test suite is
# in, but the groups themselves are run in testsuite-dir/group-dir.
if test -n "$at_top_srcdir"; then
  builddir=../..
  for at_dir_var in srcdir top_srcdir top_build_prefix
  do
    eval at_val=\$at_$at_dir_var
    case $at_val in
      [\\/$]* | ?:[\\/]* ) at_prefix= ;;
      *) at_prefix=../../ ;;
    esac
    eval "$at_dir_var=\$at_prefix\$at_val"
  done
fi

## -------------------- ##
## Directory structure. ##
## -------------------- ##

# This is the set of directories and files used by this script
# (non-literals are capitalized):
#
# TESTSUITE         - the testsuite
# TESTSUITE.log     - summarizes the complete testsuite run
# TESTSUITE.dir/    - created during a run, remains after -d or failed test
# + at-groups/      - during a run: status of all groups in run
# | + NNN/          - during a run: meta-data about test group NNN
# | | + check-line  - location (source file and line) of current AT_CHECK
# | | + status      - exit status of current AT_CHECK
# | | + stdout      - stdout of current AT_CHECK
# | | + stder1      - stderr, including trace
# | | + stderr      - stderr, with trace filtered out
# | | + test-source - portion of testsuite that defines group
# | | + times       - timestamps for computing duration
# | | + pass        - created if group passed
# | | + xpass       - created if group xpassed
# | | + fail        - created if group failed
# | | + xfail       - created if group xfailed
# | | + skip        - created if group skipped
# + at-stop         - during a run: end the run if this file exists
# + at-source-lines - during a run: cache of TESTSUITE line numbers for extraction
# + 0..NNN/         - created for each group NNN, remains after -d or failed test
# | + TESTSUITE.log - summarizes the group results
# | + ...           - files created during the group

# The directory the whole suite works in.
# Should be absolute to let the user `cd' at will.
at_suite_dir=$at_dir/$as_me.dir
# The file containing the suite ($at_dir might have changed since earlier).
at_suite_log=$at_dir/$as_me.log
# The directory containing helper files per test group.
at_helper_dir=$at_suite_dir/at-groups
# Stop file: if it exists, do not start new jobs.
at_stop_file=$at_suite_dir/at-stop
# The fifo used for the job dispatcher.
at_job_fifo=$at_suite_dir/at-job-fifo

if $at_clean; then
  test -d "$at_suite_dir" &&
    find "$at_suite_dir" -type d ! -perm -700 -exec chmod u+rwx \{\} \;
  rm -f -r "$at_suite_dir" "$at_suite_log"
  exit $?
fi

# Don't take risks: use only absolute directories in PATH.
#
# For stand-alone test suites (ie. atconfig was not found),
# AUTOTEST_PATH is relative to `.'.
#
# For embedded test suites, AUTOTEST_PATH is relative to the top level
# of the package.  Then expand it into build/src parts, since users
# may create executables in both places.
AUTOTEST_PATH=`printf "%s\n" "$AUTOTEST_PATH" | sed "s|:|$PATH_SEPARATOR|g"`
at_path=
as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $AUTOTEST_PATH $PATH
do
  IFS=$as_save_IFS
  case $as_dir in #(((
    '') as_dir=./ ;;
    */) ;;
    *) as_dir=$as_dir/ ;;
  esac
    test -n "$at_path" && as_fn_append at_path $PATH_SEPARATOR
case $as_dir in
  [\\/]* | ?:[\\/]* )
    as_fn_append at_path "$as_dir"
    ;;
  * )
    if test -z "$at_top_build_prefix"; then
      # Stand-alone test suite.
      as_fn_append at_path "$as_dir"
    else
      # Embedded test suite.
      as_fn_append at_path "$at_top_build_prefix$as_dir$PATH_SEPARATOR"
      as_fn_append at_path "$at_top_srcdir/$as_dir"
    fi
    ;;
esac
  done
IFS=$as_save_IFS


# Now build and simplify PATH.
#
# There might be directories that don't exist, but don't redirect
# builtins' (eg., cd) stderr directly: Ultrix's sh hates that.
at_new_path=
as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $at_path
do
  IFS=$as_save_IFS
  case $as_dir in #(((
    '') as_dir=./ ;;
    */) ;;
    *) as_dir=$as_dir/ ;;
  esac
    test -d "$as_dir" || continue
case $as_dir in
  [\\/]* | ?:[\\/]* ) ;;
  * ) as_dir=`(cd "$as_dir" && pwd) 2>/dev/null` ;;
esac
case $PATH_SEPARATOR$at_new_path$PATH_SEPARATOR in
  *$PATH_SEPARATOR$as_dir$PATH_SEPARATOR*) ;;
  $PATH_SEPARATOR$PATH_SEPARATOR) at_new_path=$as_dir ;;
  *) as_fn_append at_new_path "$PATH_SEPARATOR$as_dir" ;;
esac
  done
IFS=$as_save_IFS

PATH=$at_new_path
export PATH

# Setting up the FDs.



# 5 is the log file.  Not to be overwritten if `-d'.
if $at_debug_p; then
  at_suite_log=/dev/null
else
  : >"$at_suite_log"
fi
exec 5>>"$at_suite_log"

# Banners and logs.
printf "%s\n" "## ----------------------------- ##
## openvswitch 3.1.2 test suite. ##
## ----------------------------- ##"
{
  printf "%s\n" "## ----------------------------- ##
## openvswitch 3.1.2 test suite. ##
## ----------------------------- ##"
  echo

  printf "%s\n" "$as_me: command line was:"
  printf "%s\n" "  \$ $0 $at_cli_args"
  echo

  # If ChangeLog exists, list a few lines in case it might help determining
  # the exact version.
  if test -n "$at_top_srcdir" && test -f "$at_top_srcdir/ChangeLog"; then
    printf "%s\n" "## ---------- ##
## ChangeLog. ##
## ---------- ##"
    echo
    sed 's/^/| /;10q' "$at_top_srcdir/ChangeLog"
    echo
  fi

  {
cat <<_ASUNAME
## --------- ##
## Platform. ##
## --------- ##

hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
uname -m = `(uname -m) 2>/dev/null || echo unknown`
uname -r = `(uname -r) 2>/dev/null || echo unknown`
uname -s = `(uname -s) 2>/dev/null || echo unknown`
uname -v = `(uname -v) 2>/dev/null || echo unknown`

/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`

/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`

_ASUNAME

as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  case $as_dir in #(((
    '') as_dir=./ ;;
    */) ;;
    *) as_dir=$as_dir/ ;;
  esac
    printf "%s\n" "PATH: $as_dir"
  done
IFS=$as_save_IFS

}
  echo

  # Contents of the config files.
  for at_file in atconfig atlocal
  do
    test -r $at_file || continue
    printf "%s\n" "$as_me: $at_file:"
    sed 's/^/| /' $at_file
    echo
  done
} >&5


## ------------------------- ##
## Autotest shell functions. ##
## ------------------------- ##

# at_fn_banner NUMBER
# -------------------
# Output banner NUMBER, provided the testsuite is running multiple groups and
# this particular banner has not yet been printed.
at_fn_banner ()
{
  $at_print_banners || return 0
  eval at_banner_text=\$at_banner_text_$1
  test "x$at_banner_text" = "x " && return 0
  eval "at_banner_text_$1=\" \""
  if test -z "$at_banner_text"; then
    $at_first || echo
  else
    printf "%s\n" "$as_nl$at_banner_text$as_nl"
  fi
} # at_fn_banner

# at_fn_check_prepare_notrace REASON LINE
# ---------------------------------------
# Perform AT_CHECK preparations for the command at LINE for an untraceable
# command; REASON is the reason for disabling tracing.
at_fn_check_prepare_notrace ()
{
  $at_trace_echo "Not enabling shell tracing (command contains $1)"
  printf "%s\n" "$2" >"$at_check_line_file"
  at_check_trace=: at_check_filter=:
  : >"$at_stdout"; : >"$at_stderr"
}

# at_fn_check_prepare_trace LINE
# ------------------------------
# Perform AT_CHECK preparations for the command at LINE for a traceable
# command.
at_fn_check_prepare_trace ()
{
  printf "%s\n" "$1" >"$at_check_line_file"
  at_check_trace=$at_traceon at_check_filter=$at_check_filter_trace
  : >"$at_stdout"; : >"$at_stderr"
}

# at_fn_check_prepare_dynamic COMMAND LINE
# ----------------------------------------
# Decide if COMMAND at LINE is traceable at runtime, and call the appropriate
# preparation function.
at_fn_check_prepare_dynamic ()
{
  case $1 in
    *$as_nl*)
      at_fn_check_prepare_notrace 'an embedded newline' "$2" ;;
    *)
      at_fn_check_prepare_trace "$2" ;;
  esac
}

# at_fn_filter_trace
# ------------------
# Remove the lines in the file "$at_stderr" generated by "set -x" and print
# them to stderr.
at_fn_filter_trace ()
{
  mv "$at_stderr" "$at_stder1"
  grep '^ *+' "$at_stder1" >&2
  grep -v '^ *+' "$at_stder1" >"$at_stderr"
}

# at_fn_log_failure FILE-LIST
# ---------------------------
# Copy the files in the list on stdout with a "> " prefix, and exit the shell
# with a failure exit code.
at_fn_log_failure ()
{
  for file
    do printf "%s\n" "$file:"; sed 's/^/> /' "$file"; done
  echo 1 > "$at_status_file"
  exit 1
}

# at_fn_check_skip EXIT-CODE LINE
# -------------------------------
# Check whether EXIT-CODE is a special exit code (77 or 99), and if so exit
# the test group subshell with that same exit code. Use LINE in any report
# about test failure.
at_fn_check_skip ()
{
  case $1 in
    99) echo 99 > "$at_status_file"; at_failed=:
	printf "%s\n" "$2: hard failure"; exit 99;;
    77) echo 77 > "$at_status_file"; exit 77;;
  esac
}

# at_fn_check_status EXPECTED EXIT-CODE LINE
# ------------------------------------------
# Check whether EXIT-CODE is the EXPECTED exit code, and if so do nothing.
# Otherwise, if it is 77 or 99, exit the test group subshell with that same
# exit code; if it is anything else print an error message referring to LINE,
# and fail the test.
at_fn_check_status ()
{
  case $2 in
    $1 ) ;;
    77) echo 77 > "$at_status_file"; exit 77;;
    99) echo 99 > "$at_status_file"; at_failed=:
	printf "%s\n" "$3: hard failure"; exit 99;;
    *) printf "%s\n" "$3: exit code was $2, expected $1"
      at_failed=:;;
  esac
}

# at_fn_diff_devnull FILE
# -----------------------
# Emit a diff between /dev/null and FILE. Uses "test -s" to avoid useless diff
# invocations.
at_fn_diff_devnull ()
{
  test -s "$1" || return 0
  $at_diff "$at_devnull" "$1"
}

# at_fn_test NUMBER
# -----------------
# Parse out test NUMBER from the tail of this file.
at_fn_test ()
{
  eval at_sed=\$at_sed$1
  sed "$at_sed" "$at_myself" > "$at_test_source"
}

# at_fn_create_debugging_script
# -----------------------------
# Create the debugging script $at_group_dir/run which will reproduce the
# current test group.
at_fn_create_debugging_script ()
{
  {
    echo "#! /bin/sh" &&
    echo 'test ${ZSH_VERSION+y} && alias -g '\''${1+"$@"}'\''='\''"$@"'\''' &&
    printf "%s\n" "cd '$at_dir'" &&
    printf "%s\n" "exec \${CONFIG_SHELL-$SHELL} \"$at_myself\" -v -d $at_debug_args $at_group \${1+\"\$@\"}" &&
    echo 'exit 1'
  } >"$at_group_dir/run" &&
  chmod +x "$at_group_dir/run"
}

## -------------------------------- ##
## End of autotest shell functions. ##
## -------------------------------- ##


# Set ovs_base to the base directory in which the test is running and
# initialize the OVS_*DIR environment variables to point to this
# directory.
ovs_init() {
    ovs_base=`pwd`
    trap ovs_on_exit 0
    : > cleanup
    ovs_setenv
}

# Catch testsuite error condition and cleanup test environment by tearing down
# all interfaces and processes spawned.
# User has an option to leave the test environment in error state so that system
# can be poked around to get more information. User can enable this option by setting
# environment variable OVS_PAUSE_TEST=1. User needs to press CTRL-D to resume the
# cleanup operation.
ovs_pause() {
    echo "====================================================="
    echo "Set following environment variable to use various ovs utilities"
    echo "export OVS_RUNDIR=$ovs_base"
    echo "Press ENTER to continue: "
    read
}

ovs_on_exit () {
    if [ ! -z "${OVS_PAUSE_TEST}" ] && [ -z $at_verbose ]; then
        trap '' INT
        ovs_pause
    fi
    . "$ovs_base/cleanup"
}

# With no parameter or an empty parameter, sets the OVS_*DIR
# environment variables to point to $ovs_base, the base directory in
# which the test is running.
#
# With a parameter, sets them to $ovs_base/$1.
ovs_setenv() {
    sandbox=$1
    ovs_dir=$ovs_base${1:+/$1}
    OVS_RUNDIR=$ovs_dir; export OVS_RUNDIR
    OVS_LOGDIR=$ovs_dir; export OVS_LOGDIR
    OVS_DBDIR=$ovs_dir; export OVS_DBDIR
    OVS_SYSCONFDIR=$ovs_dir; export OVS_SYSCONFDIR
    OVS_PKGDATADIR=$ovs_dir; export OVS_PKGDATADIR
}

# Prints the integers from $1 to $2, increasing by $3 (default 1) on stdout.
seq () {
    if test $# = 1; then
        set 1 $1
    fi
    while test $1 -le $2; do
        echo $1
        set `expr $1 + ${3-1}` $2 $3
    done
}

if test "$IS_WIN32" = "yes"; then
    pwd () {
        command pwd -W "$@"
    }

    diff () {
        command diff --strip-trailing-cr "$@"
    }

    # tskill is more effective than taskkill but it isn't always installed.
    if (tskill //?) >/dev/null 2>&1; then :; else
        tskill () { taskkill //F //PID $1 >/dev/null; }
    fi

    kill () {
        signal=
        retval=0
        for arg; do
            arg=$(echo $arg | tr -d '\n\r')
            case $arg in
            -*) signal=$arg ;;
            [1-9][0-9]*)
                # tasklist always returns 0.
                # If pid does exist, there will be a line with the pid.
                if tasklist //fi "PID eq $arg" | grep $arg >/dev/null; then
                    if test "X$signal" != "X-0"; then
                        tskill $arg
                    fi
                else
                    retval=1
                fi
                ;;
            esac
        done
        return $retval
    }
fi

# parent_pid PID
#
# Prints the PID of the parent of process PID.
parent_pid () {
    # Using "ps" is portable to any POSIX system, but busybox "ps" (used in
    # e.g. Alpine Linux) is noncompliant, so we use a Linux-specific approach
    # when it's available.  We check the format of the status file to avoid
    # the NetBSD file with the same name but different contents.
    if grep -E '^PPid:[[:space:]]*[0-9]*$' /proc/$1/status > /dev/null 2>&1; then
        sed -n 's/^PPid:	\([0-9]*\)/\1/p' /proc/$1/status
    else
        ps -o ppid= -p $1
    fi
}

# kill_ovs_vswitchd [PID]
#
# Signal the ovs-vswitchd daemon to exit gracefully and wait for it to
# terminate or kill it if that takes too long.
#
# It is used to cleanup all sorts of tests and results. It can't assume
# any state, including the availability of PID file which can be provided.
kill_ovs_vswitchd () {
    # Use provided PID or save the current PID if available.
    TMPPID=$1
    if test -z "$TMPPID"; then
        TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid 2>/dev/null)
    fi

    # Tell the daemon to terminate gracefully
    ovs-appctl -t ovs-vswitchd exit --cleanup 2>/dev/null

    # Nothing else to be done if there is no PID
    test -z "$TMPPID" && return

    for i in 1 2 3 4 5 6 7 8 9; do
        # Check if the daemon is alive.
        kill -0 $TMPPID 2>/dev/null || return

        # Fallback to whole number since POSIX doesn't require
        # fractional times to work.
        sleep 0.1 || sleep 1
    done

    # Make sure it is terminated.
    kill $TMPPID
}

# Normalize the output of 'wc' to match POSIX.
# POSIX says 'wc' should print "%d %d %d", but GNU prints "%7d %7d %7d".
# POSIX says 'wc -l' should print "%d %s", but BSD prints "%8d".
#
# This fixes all of those (it will screw up filenames that contain
# multiple sequential spaces, but that doesn't really matter).
wc () {
   command wc "$@" | tr -s ' ' ' ' | sed 's/^ *//'
}

uuidfilt () {
    $PYTHON3 "$top_srcdir"/tests/uuidfilt.py "$@"
}

# run_as PROGRAM_NAME COMMAND [ARG...]
#
# Runs a command with argv[0] set to PROGRAM_NAME, if possible, in a
# subshell.  Most utilities print argc[0] as part of their messages,
# so this makes it easier to figure out which particular utility
# prints a message if a bunch of identical processes are running.
#
# Not all shells support "exec -a NAME", so test for it.
if (exec -a myname true 2>/dev/null); then
    run_as () {
        (exec -a "$@")
    }
else
    run_as () {
        shift
        (exec "$@")
    }
fi


ovs_cleanup() {
    if test "$(echo asan.*)" != 'asan.*'; then
        echo "Address Sanitizer reported errors in:" asan.*
        cat asan.*
        printf "%s\n" "ovs-macros.at:217" >"$at_check_line_file"
at_fn_check_skip 99 "$at_srcdir/ovs-macros.at:217"
    fi
    if test "$(echo ubsan.*)" != 'ubsan.*'; then
        echo "Undefined Behavior Sanitizer reported errors in:" ubsan.*
        cat ubsan.*
        printf "%s\n" "ovs-macros.at:222" >"$at_check_line_file"
at_fn_check_skip 99 "$at_srcdir/ovs-macros.at:222"
    fi
}

ovs_wait () {
    echo "$1: waiting $2..." >&5

    # First try the condition without waiting.
    if ovs_wait_cond; then echo "$1: wait succeeded immediately" >&5; return 0; fi

    # Try a quick sleep, so that the test completes very quickly
    # in the normal case.  POSIX doesn't require fractional times to
    # work, so this might not work.
    sleep 0.1
    if ovs_wait_cond; then echo "$1: wait succeeded quickly" >&5; return 0; fi

    # Then wait up to OVS_CTL_TIMEOUT seconds.
    local d
    for d in `seq 1 "$OVS_CTL_TIMEOUT"`; do
        sleep 1
        if ovs_wait_cond; then echo "$1: wait succeeded after $d seconds" >&5; return 0; fi
    done

    echo "$1: wait failed after $d seconds" >&5
    ovs_wait_failed
    printf "%s\n" "ovs-macros.at:247" >"$at_check_line_file"
at_fn_check_skip 99 "$at_srcdir/ovs-macros.at:247"
}

   on_exit () {
    (echo "$1"; cat cleanup) > cleanup.tmp
    mv cleanup.tmp cleanup
}


ovsdb_client_wait() {
    ovsdb-client -vconsole:warn -vreconnect:err -vjsonrpc:err -vtimeval:off -vfile -vsyslog:off -vvlog:off wait "$@"
}



# Strips out uninteresting parts of ovs-ofctl output, as well as parts
# that vary from one run to another.
ofctl_strip () {
    sed '
s/ (xid=0x[0-9a-fA-F]*)//
s/ duration=[0-9.]*s,//
s/ cookie=0x0,//
s/ table=0,//
s/ n_packets=0,//
s/ n_bytes=0,//
s/ idle_age=[0-9]*,//
s/ hard_age=[0-9]*,//
s/dp_hash=0x[0-9a-f]*\//dp_hash=0x0\//
s/recirc_id=0x[0-9a-f]*,/recirc_id=0x0,/
s/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]T[0-9][0-9]:[0-9][0-9]:[0-9][0-9]Z|//
s/dir\/[0-9]*\/br0.mgmt/dir\/XXXX\/br0.mgmt/
'
}

# Filter (multiline) vconn debug messages from ovs-vswitchd.log.
# Use with vconn_sub() and ofctl_strip()
print_vconn_debug () { awk -F\| < ovs-vswitchd.log '
BEGIN { prt=0 }
/\|vconn\|DBG\|/ { sub(/[ \t]*$/, ""); print $3 "|" $4 "|" $5; prt=1; next }
$4 != "" { prt=0; next }
prt==1 { sub(/[ \t]*$/, ""); print $0 }
'
}

vconn_sub() {
    sed '
s/tcp:127.0.0.1:[0-9][0-9]*:/unix:/
s/unix#[0-9]*:/unix:/
'
}


# PARSE_LISTENING_PORT LOGFILE VARIABLE
#
# Parses the TCP or SSL port on which a server is listening from
# LOGFILE, given that the server was told to listen on a kernel-chosen
# port, and assigns the port number to shell VARIABLE.  You should
# specify the listening remote as ptcp:0:127.0.0.1 or
# pssl:0:127.0.0.1, or the equivalent with [::1] instead of 127.0.0.1.
#
# Here's an example of how to use this with ovsdb-server:
#
#    ovsdb-server --log-file --remote=ptcp:0:127.0.0.1 ...
#    PARSE_LISTENING_PORT([ovsdb-server.log], [TCP_PORT])
#    # Now $TCP_PORT holds the listening port.


start_daemon () {
    "$@" -vconsole:off --detach --no-chdir --pidfile --log-file
    pidfile="$OVS_RUNDIR"/$1.pid
    on_exit "test -e \"$pidfile\" && kill \`cat \"$pidfile\"\`"
}

# sim_add SANDBOX
#
# Starts a new simulated Open vSwitch instance named SANDBOX.  Files related to
# the instance, such as logs, databases, sockets, and pidfiles, are created in
# a subdirectory of the main test directory also named SANDBOX.  Afterward, the
# "as" command (see below) can be used to run Open vSwitch utilities in the
# context of the new sandbox.
#
# The new sandbox starts out without any bridges.  Use ovs-vsctl in the context
# of the new sandbox to create a bridge, e.g.:
#
#     sim_add hv0           # Create sandbox hv0.
#     as hv0                # Set hv0 as default sandbox.
#     ovs-vsctl add-br br0  # Add bridge br0 inside hv0.
#
# or:
#
#     sim_add hv0
#     as hv0 ovs-vsctl add-br br0
sims=
sim_add () {
   echo "adding simulator '$1'"

   sims="$sims $1"

   # Create sandbox.
   local d="$ovs_base"/$1
   mkdir "$d" || return 1
   ovs_setenv $1

   # Create database and start ovsdb-server.
   : > "$d"/.conf.db.~lock~
   as $1 ovsdb-tool create "$d"/conf.db "$abs_top_srcdir"/vswitchd/vswitch.ovsschema || return 1
   as $1 start_daemon ovsdb-server --remote=punix:"$d"/db.sock || return 1

   # Initialize database.
   as $1 ovs-vsctl --no-wait -- init || return 1

   # Start ovs-vswitchd
   as $1 start_daemon ovs-vswitchd --enable-dummy=system -vvconn -vofproto_dpif -vunixctl
}

# "as $1" sets the OVS_*DIR environment variables to point to $ovs_base/$1.
#
# "as $1 COMMAND..." sets those variables in a subshell and invokes COMMAND
# there.
as() {
    if test "X$2" != X; then
        (ovs_setenv $1; shift; "$@")
    else
        ovs_setenv $1
    fi
}

# Strips 'xid=0x1234' from ovs-ofctl output.
strip_xids () {
    sed 's/ (xid=0x[0-9a-fA-F]*)//'
}

# Changes all 'used:...' to say 'used:0.0', to make output easier to compare.
strip_used () {
    sed 's/used:[0-9]\.[0-9]*/used:0.0/'
}

# Removes all 'duration=...' to make output easier to compare.
strip_duration () {
    sed 's/duration=[0-9]*\.[0-9]*s,//'
}

# Strips 'ufid:...' from output, to make it easier to compare.
# (ufids are random.)
strip_ufid () {
    sed 's/mega_ufid:[-0-9a-f]* //
    s/ufid:[-0-9a-f]* //'
}

# Strips packets: and bytes: from output
strip_stats () {
    sed 's/packets:[0-9]*/packets:0/
    s/bytes:[0-9]*/bytes:0/'
}

# Changes all 'recirc(...)' and 'recirc=...' to say 'recirc(<recirc_id>)' and
# 'recirc=<recirc_id>' respectively.  This should make output easier to
# compare.
strip_recirc() {
   sed 's/recirc_id([x0-9]*)/recirc_id(<recirc>)/
        s/recirc_id=[x0-9]*/recirc_id=<recirc>/
        s/recirc([x0-9]*)/recirc(<recirc>)/'
}

check_logs () {
    local logs
    for log in *.log; do
        case ${log} in # (
            '*.log'|testsuite.log) ;; # (
            *) logs="${logs} ${log}" ;;
        esac
    done

    # We most notably ignore 'Broken pipe' warnings.  These often and
    # intermittently appear in ovsdb-server.log, because *ctl commands
    # (e.g. ovs-vsctl) exit right after committing a change to the
    # database.  However, in reaction, some daemon may immediately update the
    # database, and this later update may cause database sending update back to
    # *ctl command if *ctl has not exited yet.  If *ctl command exits before
    # the database calls send, the send fails with 'Broken pipe' or
    # 'not connected' depending on system.  Also removes all 'connection reset'
    # warning logs for similar reasons (EPIPE, ENOTCONN or ECONNRESET can be
    # returned on a send depending on whether the peer had unconsumed data
    # when it closed the socket).
    #
    # We also ignore "Dropped # log messages..." messages.  Otherwise, even if
    # we ignore the messages that were rate-limited, we can end up failing just
    # because of the announcement that rate-limiting happened (and in a racy,
    # timing-dependent way, too).
    sed -n "$1
/reset by peer/d
/Broken pipe/d
/is not connected/d
/timeval.*Unreasonably long [0-9]*ms poll interval/d
/timeval.*faults: [0-9]* minor, [0-9]* major/d
/timeval.*disk: [0-9]* reads, [0-9]* writes/d
/timeval.*context switches: [0-9]* voluntary, [0-9]* involuntary/d
/ovs_rcu.*blocked [0-9]* ms waiting for .* to quiesce/d
/Dropped [0-9]* log messages/d
/setting extended ack support failed/d
/|WARN|/p
/|ERR|/p
/|EMER|/p" ${logs}
}

# add_of_br BRNUM [ARG...]
add_of_br () {
    local brnum=$1; shift
    local br=br$brnum
    local dpid=fedcba987654321$brnum
    local mac=aa:55:aa:55:00:0$brnum
    ovs-vsctl \
        -- add-br $br \
        -- set bridge $br datapath-type=dummy \
                          fail-mode=secure \
                          other-config:datapath-id=$dpid \
                          other-config:hwaddr=$mac \
                          protocols="[OpenFlow10,OpenFlow11,OpenFlow12,\
                                       OpenFlow13,OpenFlow14,OpenFlow15]" \
        -- "$@"
}

# add_of_ports__ PORT_TYPE [--pcap] BRIDGE PNUM...
#
# Creates PORT_TYPE interfaces in BRIDGE named pPNUM, OpenFlow port number
# PNUM, and datapath port number PNUM (the latter is a consequence of
# the dummy implementation, which tries to assign datapath port
# numbers based on port names).
#
# If --pcap is supplied then packets received from the interface will
# be written to $port-rx.pcap and those sent to it to $port-tx.pcap.
add_of_ports__ () {
    local args
    local pcap=false
    local ptype=$1
    shift
    if test "$1" = --pcap; then
        pcap=:
    shift
    fi
    local br=$1; shift
    for pnum; do
        as_fn_append args " -- add-port $br p$pnum -- set Interface p$pnum type=$ptype ofport_request=$pnum"
    if $pcap; then
        as_fn_append args " -- set Interface p$pnum options:rxq_pcap=p$pnum-rx.pcap options:tx_pcap=p$pnum-tx.pcap"
    fi
    done
    echo ovs-vsctl $args
    ovs-vsctl $args
}

# add_of_ports [--pcap] BRIDGE PNUM...
#
add_of_ports () {
    add_of_ports__ dummy $@
}

# add_pmd_of_ports [--pcap] BRIDGE PNUM...
#
add_pmd_of_ports () {
    add_of_ports__ dummy-pmd $@
}

{
  printf "%s\n" "## ---------------- ##
## Tested programs. ##
## ---------------- ##"
  echo
} >&5

# Report what programs are being tested.
for at_program in : `eval echo $at_tested`
do
  case $at_program in #(
  :) :
    continue ;; #(
  [\\/]* | ?:[\\/]*) :
    at_program_=$at_program ;; #(
  *) :
    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  case $as_dir in #(((
    '') as_dir=./ ;;
    */) ;;
    *) as_dir=$as_dir/ ;;
  esac
    test -f "$as_dir$at_program" && break
  done
IFS=$as_save_IFS

    at_program_=$as_dir$at_program ;;
esac

  if test -f "$at_program_"; then
    {
      printf "%s\n" "$at_srcdir/system-dpdk-testsuite.at:1: $at_program_ --version"
      "$at_program_" --version </dev/null
      echo
    } >&5 2>&1
  else
    as_fn_error $? "cannot find $at_program" "$LINENO" 5
  fi
done

{
  printf "%s\n" "## ------------------ ##
## Running the tests. ##
## ------------------ ##"
} >&5

at_start_date=`date`
at_start_time=`date +%s 2>/dev/null`
printf "%s\n" "$as_me: starting at: $at_start_date" >&5

# Create the master directory if it doesn't already exist.
as_dir="$at_suite_dir"; as_fn_mkdir_p ||
  as_fn_error $? "cannot create \`$at_suite_dir'" "$LINENO" 5

# Can we diff with `/dev/null'?  DU 5.0 refuses.
if diff /dev/null /dev/null >/dev/null 2>&1; then
  at_devnull=/dev/null
else
  at_devnull=$at_suite_dir/devnull
  >"$at_devnull"
fi

# Use `diff -u' when possible.
if at_diff=`diff -u "$at_devnull" "$at_devnull" 2>&1` && test -z "$at_diff"
then
  at_diff='diff -u'
else
  at_diff=diff
fi

# Get the last needed group.
for at_group in : $at_groups; do :; done

# Extract the start and end lines of each test group at the tail
# of this file
awk '
BEGIN { FS="" }
/^#AT_START_/ {
  start = NR
}
/^#AT_STOP_/ {
  test = substr ($ 0, 10)
  print "at_sed" test "=\"1," start "d;" (NR-1) "q\""
  if (test == "'"$at_group"'") exit
}' "$at_myself" > "$at_suite_dir/at-source-lines" &&
. "$at_suite_dir/at-source-lines" ||
  as_fn_error $? "cannot create test line number cache" "$LINENO" 5
rm -f "$at_suite_dir/at-source-lines"

# Set number of jobs for `-j'; avoid more jobs than test groups.
set X $at_groups; shift; at_max_jobs=$#
if test $at_max_jobs -eq 0; then
  at_jobs=1
fi
if test $at_jobs -ne 1 &&
   { test $at_jobs -eq 0 || test $at_jobs -gt $at_max_jobs; }; then
  at_jobs=$at_max_jobs
fi

# If parallel mode, don't output banners, don't split summary lines.
if test $at_jobs -ne 1; then
  at_print_banners=false
  at_quiet=:
fi

# Set up helper dirs.
rm -rf "$at_helper_dir" &&
mkdir "$at_helper_dir" &&
cd "$at_helper_dir" &&
{ test -z "$at_groups" || mkdir $at_groups; } ||
as_fn_error $? "testsuite directory setup failed" "$LINENO" 5

# Functions for running a test group.  We leave the actual
# test group execution outside of a shell function in order
# to avoid hitting zsh 4.x exit status bugs.

# at_fn_group_prepare
# -------------------
# Prepare for running a test group.
at_fn_group_prepare ()
{
  # The directory for additional per-group helper files.
  at_job_dir=$at_helper_dir/$at_group
  # The file containing the location of the last AT_CHECK.
  at_check_line_file=$at_job_dir/check-line
  # The file containing the exit status of the last command.
  at_status_file=$at_job_dir/status
  # The files containing the output of the tested commands.
  at_stdout=$at_job_dir/stdout
  at_stder1=$at_job_dir/stder1
  at_stderr=$at_job_dir/stderr
  # The file containing the code for a test group.
  at_test_source=$at_job_dir/test-source
  # The file containing dates.
  at_times_file=$at_job_dir/times

  # Be sure to come back to the top test directory.
  cd "$at_suite_dir"

  # Clearly separate the test groups when verbose.
  $at_first || $at_verbose echo

  at_group_normalized=$at_group

  eval 'while :; do
    case $at_group_normalized in #(
    '"$at_format"'*) break;;
    esac
    at_group_normalized=0$at_group_normalized
  done'


  # Create a fresh directory for the next test group, and enter.
  # If one already exists, the user may have invoked ./run from
  # within that directory; we remove the contents, but not the
  # directory itself, so that we aren't pulling the rug out from
  # under the shell's notion of the current directory.
  at_group_dir=$at_suite_dir/$at_group_normalized
  at_group_log=$at_group_dir/$as_me.log
  if test -d "$at_group_dir"
then
  find "$at_group_dir" -type d ! -perm -700 -exec chmod u+rwx {} \;
  rm -fr "$at_group_dir"/* "$at_group_dir"/.[!.] "$at_group_dir"/.??*
fi ||
    { printf "%s\n" "$as_me:${as_lineno-$LINENO}: WARNING: test directory for $at_group_normalized could not be cleaned" >&5
printf "%s\n" "$as_me: WARNING: test directory for $at_group_normalized could not be cleaned" >&2;}
  # Be tolerant if the above `rm' was not able to remove the directory.
  as_dir="$at_group_dir"; as_fn_mkdir_p

  echo 0 > "$at_status_file"

  # In verbose mode, append to the log file *and* show on
  # the standard output; in quiet mode only write to the log.
  if test -z "$at_verbose"; then
    at_tee_pipe='tee -a "$at_group_log"'
  else
    at_tee_pipe='cat >> "$at_group_log"'
  fi
}

# at_fn_group_banner ORDINAL LINE DESC PAD [BANNER]
# -------------------------------------------------
# Declare the test group ORDINAL, located at LINE with group description DESC,
# and residing under BANNER. Use PAD to align the status column.
at_fn_group_banner ()
{
  at_setup_line="$2"
  test -n "$5" && at_fn_banner $5
  at_desc="$3"
  case $1 in
    [0-9])      at_desc_line="  $1: ";;
    [0-9][0-9]) at_desc_line=" $1: " ;;
    *)          at_desc_line="$1: "  ;;
  esac
  as_fn_append at_desc_line "$3$4"
  $at_quiet printf %s "$at_desc_line"
  echo "#                             -*- compilation -*-" >> "$at_group_log"
}

# at_fn_group_postprocess
# -----------------------
# Perform cleanup after running a test group.
at_fn_group_postprocess ()
{
  # Be sure to come back to the suite directory, in particular
  # since below we might `rm' the group directory we are in currently.
  cd "$at_suite_dir"

  if test ! -f "$at_check_line_file"; then
    sed "s/^ */$as_me: WARNING: /" <<_ATEOF
      A failure happened in a test group before any test could be
      run. This means that test suite is improperly designed.  Please
      report this failure to <bugs@openvswitch.org>.
_ATEOF
    printf "%s\n" "$at_setup_line" >"$at_check_line_file"
    at_status=99
  fi
  $at_verbose printf %s "$at_group. $at_setup_line: "
  printf %s "$at_group. $at_setup_line: " >> "$at_group_log"
  case $at_xfail:$at_status in
    yes:0)
	at_msg="UNEXPECTED PASS"
	at_res=xpass
	at_errexit=$at_errexit_p
	at_color=$at_red
	;;
    no:0)
	at_msg="ok"
	at_res=pass
	at_errexit=false
	at_color=$at_grn
	;;
    *:77)
	at_msg='skipped ('`cat "$at_check_line_file"`')'
	at_res=skip
	at_errexit=false
	at_color=$at_blu
	;;
    no:* | *:99)
	at_msg='FAILED ('`cat "$at_check_line_file"`')'
	at_res=fail
	at_errexit=$at_errexit_p
	at_color=$at_red
	;;
    yes:*)
	at_msg='expected failure ('`cat "$at_check_line_file"`')'
	at_res=xfail
	at_errexit=false
	at_color=$at_lgn
	;;
  esac
  echo "$at_res" > "$at_job_dir/$at_res"
  # In parallel mode, output the summary line only afterwards.
  if test $at_jobs -ne 1 && test -n "$at_verbose"; then
    printf "%s\n" "$at_desc_line $at_color$at_msg$at_std"
  else
    # Make sure there is a separator even with long titles.
    printf "%s\n" " $at_color$at_msg$at_std"
  fi
  at_log_msg="$at_group. $at_desc ($at_setup_line): $at_msg"
  case $at_status in
    0|77)
      # $at_times_file is only available if the group succeeded.
      # We're not including the group log, so the success message
      # is written in the global log separately.  But we also
      # write to the group log in case they're using -d.
      if test -f "$at_times_file"; then
	at_log_msg="$at_log_msg     ("`sed 1d "$at_times_file"`')'
	rm -f "$at_times_file"
      fi
      printf "%s\n" "$at_log_msg" >> "$at_group_log"
      printf "%s\n" "$at_log_msg" >&5

      # Cleanup the group directory, unless the user wants the files
      # or the success was unexpected.
      if $at_debug_p || test $at_res = xpass; then
	at_fn_create_debugging_script
	if test $at_res = xpass && $at_errexit; then
	  echo stop > "$at_stop_file"
	fi
      else
	if test -d "$at_group_dir"; then
	  find "$at_group_dir" -type d ! -perm -700 -exec chmod u+rwx \{\} \;
	  rm -fr "$at_group_dir"
	fi
	rm -f "$at_test_source"
      fi
      ;;
    *)
      # Upon failure, include the log into the testsuite's global
      # log.  The failure message is written in the group log.  It
      # is later included in the global log.
      printf "%s\n" "$at_log_msg" >> "$at_group_log"

      # Upon failure, keep the group directory for autopsy, and create
      # the debugging script.  With -e, do not start any further tests.
      at_fn_create_debugging_script
      if $at_errexit; then
	echo stop > "$at_stop_file"
      fi
      ;;
  esac
}


## ------------ ##
## Driver loop. ##
## ------------ ##


if (set -m && set +m && set +b) >/dev/null 2>&1; then
  set +b
  at_job_control_on='set -m' at_job_control_off='set +m' at_job_group=-
else
  at_job_control_on=: at_job_control_off=: at_job_group=
fi

for at_signal in 1 2 15; do
  trap 'set +x; set +e
	$at_job_control_off
	at_signal='"$at_signal"'
	echo stop > "$at_stop_file"
	trap "" $at_signal
	at_pgids=
	for at_pgid in `jobs -p 2>/dev/null`; do
	  at_pgids="$at_pgids $at_job_group$at_pgid"
	done
	test -z "$at_pgids" || kill -$at_signal $at_pgids 2>/dev/null
	wait
	if test "$at_jobs" -eq 1 || test -z "$at_verbose"; then
	  echo >&2
	fi
	at_signame=`kill -l $at_signal 2>&1 || echo $at_signal`
	set x $at_signame
	test 0 -gt 2 && at_signame=$at_signal
	{ printf "%s\n" "$as_me:${as_lineno-$LINENO}: WARNING: caught signal $at_signame, bailing out" >&5
printf "%s\n" "$as_me: WARNING: caught signal $at_signame, bailing out" >&2;}
	as_fn_arith 128 + $at_signal && exit_status=$as_val
	as_fn_exit $exit_status' $at_signal
done

rm -f "$at_stop_file"
at_first=:

if test $at_jobs -ne 1 &&
     rm -f "$at_job_fifo" &&
     test -n "$at_job_group" &&
     ( mkfifo "$at_job_fifo" && trap 'exit 1' PIPE STOP TSTP ) 2>/dev/null
then
  # FIFO job dispatcher.

  trap 'at_pids=
	for at_pid in `jobs -p`; do
	  at_pids="$at_pids $at_job_group$at_pid"
	done
	if test -n "$at_pids"; then
	  at_sig=TSTP
	  test ${TMOUT+y} && at_sig=STOP
	  kill -$at_sig $at_pids 2>/dev/null
	fi
	kill -STOP $$
	test -z "$at_pids" || kill -CONT $at_pids 2>/dev/null' TSTP

  echo
  # Turn jobs into a list of numbers, starting from 1.
  at_joblist=`printf "%s\n" "$at_groups" | sed -n 1,${at_jobs}p`

  set X $at_joblist
  shift
  for at_group in $at_groups; do
    $at_job_control_on 2>/dev/null
    (
      # Start one test group.
      $at_job_control_off
      if $at_first; then
	exec 7>"$at_job_fifo"
      else
	exec 6<&-
      fi
      trap 'set +x; set +e
	    trap "" PIPE
	    echo stop > "$at_stop_file"
	    echo >&7
	    as_fn_exit 141' PIPE
      at_fn_group_prepare
      if cd "$at_group_dir" &&
	 at_fn_test $at_group &&
	 . "$at_test_source"
      then :; else
	{ printf "%s\n" "$as_me:${as_lineno-$LINENO}: WARNING: unable to parse test group: $at_group" >&5
printf "%s\n" "$as_me: WARNING: unable to parse test group: $at_group" >&2;}
	at_failed=:
      fi
      at_fn_group_postprocess
      echo >&7
    ) &
    $at_job_control_off
    if $at_first; then
      at_first=false
      exec 6<"$at_job_fifo" 7>"$at_job_fifo"
    fi
    shift # Consume one token.
    if test $# -gt 0; then :; else
      read at_token <&6 || break
      set x $*
    fi
    test -f "$at_stop_file" && break
  done
  exec 7>&-
  # Read back the remaining ($at_jobs - 1) tokens.
  set X $at_joblist
  shift
  if test $# -gt 0; then
    shift
    for at_job
    do
      read at_token
    done <&6
  fi
  exec 6<&-
  wait
else
  # Run serially, avoid forks and other potential surprises.
  for at_group in $at_groups; do
    at_fn_group_prepare
    if cd "$at_group_dir" &&
       at_fn_test $at_group &&
       . "$at_test_source"; then :; else
      { printf "%s\n" "$as_me:${as_lineno-$LINENO}: WARNING: unable to parse test group: $at_group" >&5
printf "%s\n" "$as_me: WARNING: unable to parse test group: $at_group" >&2;}
      at_failed=:
    fi
    at_fn_group_postprocess
    test -f "$at_stop_file" && break
    at_first=false
  done
fi

# Wrap up the test suite with summary statistics.
cd "$at_helper_dir"

# Use ?..???? when the list must remain sorted, the faster * otherwise.
at_pass_list=`for f in */pass; do echo $f; done | sed '/\*/d; s,/pass,,'`
at_skip_list=`for f in */skip; do echo $f; done | sed '/\*/d; s,/skip,,'`
at_xfail_list=`for f in */xfail; do echo $f; done | sed '/\*/d; s,/xfail,,'`
at_xpass_list=`for f in ?/xpass ??/xpass ???/xpass ????/xpass; do
		 echo $f; done | sed '/?/d; s,/xpass,,'`
at_fail_list=`for f in ?/fail ??/fail ???/fail ????/fail; do
		echo $f; done | sed '/?/d; s,/fail,,'`

set X $at_pass_list $at_xpass_list $at_xfail_list $at_fail_list $at_skip_list
shift; at_group_count=$#
set X $at_xpass_list; shift; at_xpass_count=$#; at_xpass_list=$*
set X $at_xfail_list; shift; at_xfail_count=$#
set X $at_fail_list; shift; at_fail_count=$#; at_fail_list=$*
set X $at_skip_list; shift; at_skip_count=$#

as_fn_arith $at_group_count - $at_skip_count && at_run_count=$as_val
as_fn_arith $at_xpass_count + $at_fail_count && at_unexpected_count=$as_val
as_fn_arith $at_xfail_count + $at_fail_count && at_total_fail_count=$as_val

# Back to the top directory.
cd "$at_dir"
rm -rf "$at_helper_dir"

# Compute the duration of the suite.
at_stop_date=`date`
at_stop_time=`date +%s 2>/dev/null`
printf "%s\n" "$as_me: ending at: $at_stop_date" >&5
case $at_start_time,$at_stop_time in
  [0-9]*,[0-9]*)
    as_fn_arith $at_stop_time - $at_start_time && at_duration_s=$as_val
    as_fn_arith $at_duration_s / 60 && at_duration_m=$as_val
    as_fn_arith $at_duration_m / 60 && at_duration_h=$as_val
    as_fn_arith $at_duration_s % 60 && at_duration_s=$as_val
    as_fn_arith $at_duration_m % 60 && at_duration_m=$as_val
    at_duration="${at_duration_h}h ${at_duration_m}m ${at_duration_s}s"
    printf "%s\n" "$as_me: test suite duration: $at_duration" >&5
    ;;
esac

echo
printf "%s\n" "## ------------- ##
## Test results. ##
## ------------- ##"
echo
{
  echo
  printf "%s\n" "## ------------- ##
## Test results. ##
## ------------- ##"
  echo
} >&5

if test $at_run_count = 1; then
  at_result="1 test"
  at_were=was
else
  at_result="$at_run_count tests"
  at_were=were
fi
if $at_errexit_p && test $at_unexpected_count != 0; then
  if test $at_xpass_count = 1; then
    at_result="$at_result $at_were run, one passed"
  else
    at_result="$at_result $at_were run, one failed"
  fi
  at_result="$at_result unexpectedly and inhibited subsequent tests."
  at_color=$at_red
else
  # Don't you just love exponential explosion of the number of cases?
  at_color=$at_red
  case $at_xpass_count:$at_fail_count:$at_xfail_count in
    # So far, so good.
    0:0:0) at_result="$at_result $at_were successful." at_color=$at_grn ;;
    0:0:*) at_result="$at_result behaved as expected." at_color=$at_lgn ;;

    # Some unexpected failures
    0:*:0) at_result="$at_result $at_were run,
$at_fail_count failed unexpectedly." ;;

    # Some failures, both expected and unexpected
    0:*:1) at_result="$at_result $at_were run,
$at_total_fail_count failed ($at_xfail_count expected failure)." ;;
    0:*:*) at_result="$at_result $at_were run,
$at_total_fail_count failed ($at_xfail_count expected failures)." ;;

    # No unexpected failures, but some xpasses
    *:0:*) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly." ;;

    # No expected failures, but failures and xpasses
    *:1:0) at_result="$at_result $at_were run,
$at_unexpected_count did not behave as expected ($at_fail_count unexpected failure)." ;;
    *:*:0) at_result="$at_result $at_were run,
$at_unexpected_count did not behave as expected ($at_fail_count unexpected failures)." ;;

    # All of them.
    *:*:1) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly,
$at_total_fail_count failed ($at_xfail_count expected failure)." ;;
    *:*:*) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly,
$at_total_fail_count failed ($at_xfail_count expected failures)." ;;
  esac

  if test $at_skip_count = 0 && test $at_run_count -gt 1; then
    at_result="All $at_result"
  fi
fi

# Now put skips in the mix.
case $at_skip_count in
  0) ;;
  1) at_result="$at_result
1 test was skipped." ;;
  *) at_result="$at_result
$at_skip_count tests were skipped." ;;
esac

if test $at_unexpected_count = 0; then
  echo "$at_color$at_result$at_std"
  echo "$at_result" >&5
else
  echo "${at_color}ERROR: $at_result$at_std" >&2
  echo "ERROR: $at_result" >&5
  {
    echo
    printf "%s\n" "## ------------------------ ##
## Summary of the failures. ##
## ------------------------ ##"

    # Summary of failed and skipped tests.
    if test $at_fail_count != 0; then
      echo "Failed tests:"
      $SHELL "$at_myself" $at_fail_list --list
      echo
    fi
    if test $at_skip_count != 0; then
      echo "Skipped tests:"
      $SHELL "$at_myself" $at_skip_list --list
      echo
    fi
    if test $at_xpass_count != 0; then
      echo "Unexpected passes:"
      $SHELL "$at_myself" $at_xpass_list --list
      echo
    fi
    if test $at_fail_count != 0; then
      printf "%s\n" "## ---------------------- ##
## Detailed failed tests. ##
## ---------------------- ##"
      echo
      for at_group in $at_fail_list
      do
	at_group_normalized=$at_group

  eval 'while :; do
    case $at_group_normalized in #(
    '"$at_format"'*) break;;
    esac
    at_group_normalized=0$at_group_normalized
  done'

	cat "$at_suite_dir/$at_group_normalized/$as_me.log"
	echo
      done
      echo
    fi
    if test -n "$at_top_srcdir"; then
      sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
## ${at_top_build_prefix}config.log ##
_ASBOX
      sed 's/^/| /' ${at_top_build_prefix}config.log
      echo
    fi
  } >&5

  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
## $as_me.log was created. ##
_ASBOX

  echo
  if $at_debug_p; then
    at_msg='per-test log files'
  else
    at_msg="\`${at_testdir+${at_testdir}/}$as_me.log'"
  fi
  at_msg1a=${at_xpass_list:+', '}
  at_msg1=$at_fail_list${at_fail_list:+" failed$at_msg1a"}
  at_msg2=$at_xpass_list${at_xpass_list:+" passed unexpectedly"}

  printf "%s\n" "Please send $at_msg and all information you think might help:

   To: <bugs@openvswitch.org>
   Subject: [openvswitch 3.1.2] $as_me: $at_msg1$at_msg2

You may investigate any problem if you feel able to do so, in which
case the test suite provides a good starting point.  Its output may
be found below \`${at_testdir+${at_testdir}/}$as_me.dir'.
"
  exit 1
fi

exit 0

## ------------- ##
## Actual tests. ##
## ------------- ##
#AT_START_1
at_fn_group_banner 1 'system-dpdk.at:32' \
  "OVS-DPDK - EAL init" "                            " 1
at_xfail=no
(
  printf "%s\n" "1. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:34: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:34"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:34"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:34" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:34"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:34: mount"
at_fn_check_prepare_trace "system-dpdk.at:34"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:34"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:34: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:34"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:34"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:35"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:35"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:35"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:35"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:35"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:35"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:35"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:35: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:35"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:35"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:36: grep \"DPDK Enabled - initializing...\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:36"
( $at_check_trace; grep "DPDK Enabled - initializing..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:36"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:37: grep \"EAL\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:37"
( $at_check_trace; grep "EAL" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:37"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:38: grep \"DPDK Enabled - initialized\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:38"
( $at_check_trace; grep "DPDK Enabled - initialized" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:38"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:39: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:39"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:39"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:39: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:39"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:39"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:39: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:39"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:39"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:39" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:39"
      printf "%s\n" "system-dpdk.at:39" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:39"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:39" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:39: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:39"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:39"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:39: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:39"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:39"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:39" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:39"
      printf "%s\n" "system-dpdk.at:39" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:39"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:39" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_1
#AT_START_2
at_fn_group_banner 2 'system-dpdk.at:47' \
  "OVS-DPDK - add standard DPDK port" "              " 1
at_xfail=no
(
  printf "%s\n" "2. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:50: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:50"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:50" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:50"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:50: mount"
at_fn_check_prepare_trace "system-dpdk.at:50"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:50: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:50"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:50" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:50"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:50: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:50"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:50: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:50"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:50" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:50"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:51"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:51"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:51"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:51"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:51"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:51"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:51"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:51: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:51"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:51"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:54: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:54"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:54"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:55: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:55"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:55"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:56: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:56"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:56"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:60: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:60"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:60"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:61: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:61"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:61"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:61: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:61"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:61"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:61: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:61"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:61"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:61" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:61"
      printf "%s\n" "system-dpdk.at:61" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:61"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:61" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:61: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:61"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:61"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:61: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:61"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:61"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:61" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:61"
      printf "%s\n" "system-dpdk.at:61" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:61"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:61" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_2
#AT_START_3
at_fn_group_banner 3 'system-dpdk.at:69' \
  "OVS-DPDK - add vhost-user-client port" "          " 1
at_xfail=no
(
  printf "%s\n" "3. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:71: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:71"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:71"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:71" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:71"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:71: mount"
at_fn_check_prepare_trace "system-dpdk.at:71"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:71"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:71: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:71"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:71"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:72"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:72"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:72"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:72"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:72"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:72"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:72"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:72: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:72"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:72"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:75: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:75"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:75"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:76: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:76"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:76"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:77: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:77"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:77"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:81: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:81"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:81"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:82: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:82"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:82"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:83: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:83"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:83"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:86: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:86"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:86"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:87: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:87"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:87: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:87"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:87: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:87"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:87" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:87"
      printf "%s\n" "system-dpdk.at:87" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:87"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:87" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:87: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:87"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:87: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:87"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:87"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:87" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:87"
      printf "%s\n" "system-dpdk.at:87" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:87"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:87" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_3
#AT_START_4
at_fn_group_banner 4 'system-dpdk.at:97' \
  "OVS-DPDK - ping vhost-user ports" "               " 1
at_xfail=no
(
  printf "%s\n" "4. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:99: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:99"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:99"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:99" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:99"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:99: mount"
at_fn_check_prepare_trace "system-dpdk.at:99"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:99"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:99: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:99"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:99"
$at_failed && at_fn_log_failure
$at_traceon; }



printf "%s\n" "system-dpdk.at:100" >"$at_check_line_file"
(! which dpdk-testpmd >/dev/null 2>/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:100"
      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:101"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:101"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:101"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:101"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:101"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:101"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:101"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:101: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:101"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:101"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:104: lscpu"
at_fn_check_prepare_trace "system-dpdk.at:104"
( $at_check_trace; lscpu
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:105: cat stdout | grep \"NUMA node(s)\" | awk '{c=1; while (c++<\$(3)) {printf \"512,\"}; print \"512\"}' > NUMA_NODE"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:105"
( $at_check_trace; cat stdout | grep "NUMA node(s)" | awk '{c=1; while (c++<$(3)) {printf "512,"}; print "512"}' > NUMA_NODE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:105"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:108: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:108"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:108"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:109: ovs-vsctl add-port br10 dpdkvhostuser0 -- set Interface dpdkvhostuser0 \\
          type=dpdkvhostuser"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:109"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuser0 -- set Interface dpdkvhostuser0 \
          type=dpdkvhostuser
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:109"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:112: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:112"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:112"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:115: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostuser0) vhost-user server: socket created\" \\
          ovs-vswitchd.log"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:115"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostuser0) vhost-user server: socket created" \
          ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:115"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:117: grep \"Socket \$OVS_RUNDIR/dpdkvhostuser0 created for vhost-user port dpdkvhostuser0\" \\
          ovs-vswitchd.log"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:117"
( $at_check_trace; grep "Socket $OVS_RUNDIR/dpdkvhostuser0 created for vhost-user port dpdkvhostuser0" \
          ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:117"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:119: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostuser0) binding succeeded\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostuser0) binding succeeded\" ovs-vswitchd.log" "system-dpdk.at:119"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostuser0) binding succeeded" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:119"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del ns1



                { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:123: ip netns add ns1 || return 77"
at_fn_check_prepare_trace "system-dpdk.at:123"
( $at_check_trace; ip netns add ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del ns1


'
                ip netns exec ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del ns2



                { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:123: ip netns add ns2 || return 77"
at_fn_check_prepare_trace "system-dpdk.at:123"
( $at_check_trace; ip netns add ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:123"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del ns2


'
                ip netns exec ns2 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip link add tap1 type veth peer name ovs-tap1 || return 77"
at_fn_check_prepare_trace "system-dpdk.at:126"
( $at_check_trace; ip link add tap1 type veth peer name ovs-tap1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      on_exit 'ip link del ovs-tap1'
      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ethtool -K tap1 tx off"
at_fn_check_prepare_trace "system-dpdk.at:126"
( $at_check_trace; ethtool -K tap1 tx off
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip link set tap1 netns ns2"
at_fn_check_prepare_trace "system-dpdk.at:126"
( $at_check_trace; ip link set tap1 netns ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip link set dev ovs-tap1 up"
at_fn_check_prepare_trace "system-dpdk.at:126"
( $at_check_trace; ip link set dev ovs-tap1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ovs-vsctl add-port br10 ovs-tap1 -- \\
                set interface ovs-tap1 external-ids:iface-id=\"tap1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:126"
( $at_check_trace; ovs-vsctl add-port br10 ovs-tap1 -- \
                set interface ovs-tap1 external-ids:iface-id="tap1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.110.12/24\" dev tap1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:126"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip addr add "172.31.110.12/24" dev tap1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:126"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:126"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:126: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:126"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:126"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi



on_exit "pkill -f -x -9 'tail -f /dev/null'"
tail -f /dev/null | dpdk-testpmd --socket-mem="$(cat NUMA_NODE)" --no-pci\
           --vdev="net_virtio_user,path=$OVS_RUNDIR/dpdkvhostuser0" \
           --vdev="net_tap0,iface=tap0" --file-prefix page0 \
           --single-file-segments -- -a >$OVS_RUNDIR/testpmd-dpdkvhostuser0.log 2>&1 &

printf "%s\n" "system-dpdk.at:135" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:135"
      printf "%s\n" "system-dpdk.at:135" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:135"
   ovs_wait_cond () {
    grep "virtio is now ready for processing" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:135" "until grep \"virtio is now ready for processing\" ovs-vswitchd.log"

printf "%s\n" "system-dpdk.at:136" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:136"
      printf "%s\n" "system-dpdk.at:136" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:136"
   ovs_wait_cond () {
    ip link show dev tap0 | grep -qw LOWER_UP
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:136" "until ip link show dev tap0 | grep -qw LOWER_UP"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:139: ps aux | grep testpmd"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:139"
( $at_check_trace; ps aux | grep testpmd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:139"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:140: ip link show"
at_fn_check_prepare_trace "system-dpdk.at:140"
( $at_check_trace; ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:140"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:141: ip link set tap0 netns ns1"
at_fn_check_prepare_trace "system-dpdk.at:141"
( $at_check_trace; ip link set tap0 netns ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:141"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:143: ip netns exec ns1 ip link show"
at_fn_check_prepare_trace "system-dpdk.at:143"
( $at_check_trace; ip netns exec ns1 ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:143"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:144: ip netns exec ns1 ip link show | grep tap0"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:144"
( $at_check_trace; ip netns exec ns1 ip link show | grep tap0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:144"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:145: ip netns exec ns1 ip link set tap0 up"
at_fn_check_prepare_trace "system-dpdk.at:145"
( $at_check_trace; ip netns exec ns1 ip link set tap0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:145"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:146: ip netns exec ns1 ip addr add 172.31.110.11/24 dev tap0"
at_fn_check_prepare_trace "system-dpdk.at:146"
( $at_check_trace; ip netns exec ns1 ip addr add 172.31.110.11/24 dev tap0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:146"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:149: ip netns exec ns1 ip link show"
at_fn_check_prepare_trace "system-dpdk.at:149"
( $at_check_trace; ip netns exec ns1 ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:149"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:150: ip netns exec ns2 ip link show"
at_fn_check_prepare_trace "system-dpdk.at:150"
( $at_check_trace; ip netns exec ns2 ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:150"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:151: ip netns exec ns1 ping -c 4 -I tap0 172.31.110.12"
at_fn_check_prepare_trace "system-dpdk.at:151"
( $at_check_trace; ip netns exec ns1 ping -c 4 -I tap0 172.31.110.12
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:151"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


pkill -f -x -9 'tail -f /dev/null'

printf "%s\n" "system-dpdk.at:158" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:158"
      printf "%s\n" "system-dpdk.at:158" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:158"
   ovs_wait_cond () {
    grep "vHost Device '$OVS_RUNDIR/dpdkvhostuser0' has been removed" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:158" "until grep \"vHost Device '\$OVS_RUNDIR/dpdkvhostuser0' has been removed\" ovs-vswitchd.log"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:161: ovs-vsctl del-port br10 dpdkvhostuser0"
at_fn_check_prepare_trace "system-dpdk.at:161"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuser0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:161"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:162: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostuser0) recvmsg failed@d
\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostuser0) failed to connect: No such file or directory@d
\\@dpdkvhostuser ports are considered deprecated;  please migrate to dpdkvhostuserclient ports.@d
\\@failed to enumerate system datapaths: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:162"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostuser0) recvmsg failed@d
\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostuser0) failed to connect: No such file or directory@d
\@dpdkvhostuser ports are considered deprecated;  please migrate to dpdkvhostuserclient ports.@d
\@failed to enumerate system datapaths: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:162: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:162"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:162: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:162"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:162" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:162"
      printf "%s\n" "system-dpdk.at:162" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:162"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:162" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:162: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:162"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:162: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:162"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:162"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:162" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:162"
      printf "%s\n" "system-dpdk.at:162" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:162"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:162" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_4
#AT_START_5
at_fn_group_banner 5 'system-dpdk.at:173' \
  "OVS-DPDK - ping vhost-user-client ports" "        " 1
at_xfail=no
(
  printf "%s\n" "5. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:175: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:175"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:175"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:175" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:175"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:175: mount"
at_fn_check_prepare_trace "system-dpdk.at:175"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:175"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:175: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:175"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:175"
$at_failed && at_fn_log_failure
$at_traceon; }



printf "%s\n" "system-dpdk.at:176" >"$at_check_line_file"
(! which dpdk-testpmd >/dev/null 2>/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:176"
      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:177"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:177"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:177"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:177"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:177"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:177"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:177"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:177: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:177"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:177"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:180: lscpu"
at_fn_check_prepare_trace "system-dpdk.at:180"
( $at_check_trace; lscpu
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:180"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:181: cat stdout | grep \"NUMA node(s)\" | awk '{c=1; while (c++<\$(3)) {printf \"512,\"}; print \"512\"}' > NUMA_NODE"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:181"
( $at_check_trace; cat stdout | grep "NUMA node(s)" | awk '{c=1; while (c++<$(3)) {printf "512,"}; print "512"}' > NUMA_NODE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:181"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:184: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:184"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:184"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:185: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface \\
          dpdkvhostuserclient0 \\
          type=dpdkvhostuserclient \\
          options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:185"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface \
          dpdkvhostuserclient0 \
          type=dpdkvhostuserclient \
          options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:190: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:190"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:190"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:193: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:193"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:193"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:194: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:194"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:194"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:195: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:195"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:195"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


ip netns del ns1



                { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:198: ip netns add ns1 || return 77"
at_fn_check_prepare_trace "system-dpdk.at:198"
( $at_check_trace; ip netns add ns1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:198"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del ns1


'
                ip netns exec ns1 sysctl -w net.netfilter.nf_conntrack_helper=0
               ip netns del ns2



                { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:198: ip netns add ns2 || return 77"
at_fn_check_prepare_trace "system-dpdk.at:198"
( $at_check_trace; ip netns add ns2 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:198"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

                on_exit 'ip netns del ns2


'
                ip netns exec ns2 sysctl -w net.netfilter.nf_conntrack_helper=0




 { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip link add tap1 type veth peer name ovs-tap1 || return 77"
at_fn_check_prepare_trace "system-dpdk.at:201"
( $at_check_trace; ip link add tap1 type veth peer name ovs-tap1 || return 77
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      on_exit 'ip link del ovs-tap1'
      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ethtool -K tap1 tx off"
at_fn_check_prepare_trace "system-dpdk.at:201"
( $at_check_trace; ethtool -K tap1 tx off
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip link set tap1 netns ns2"
at_fn_check_prepare_trace "system-dpdk.at:201"
( $at_check_trace; ip link set tap1 netns ns2
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip link set dev ovs-tap1 up"
at_fn_check_prepare_trace "system-dpdk.at:201"
( $at_check_trace; ip link set dev ovs-tap1 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ovs-vsctl add-port br10 ovs-tap1 -- \\
                set interface ovs-tap1 external-ids:iface-id=\"tap1\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:201"
( $at_check_trace; ovs-vsctl add-port br10 ovs-tap1 -- \
                set interface ovs-tap1 external-ids:iface-id="tap1"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

       { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip addr add \"172.31.110.12/24\" dev tap1
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:201"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip addr add "172.31.110.12/24" dev tap1
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


       { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 up
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:201"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 up
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      if test -n ""; then
         { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 address
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:201"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip link set dev tap1 address
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi
      if test -n ""; then
         { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:201: ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:201"
( $at_check_trace; ip netns exec ns2 sh << NS_EXEC_HEREDOC
ip route add default via
NS_EXEC_HEREDOC
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:201"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


      fi



on_exit "pkill -f -x -9 'tail -f /dev/null'"
tail -f /dev/null | dpdk-testpmd --socket-mem="$(cat NUMA_NODE)" --no-pci\
    --vdev="net_virtio_user,path=$OVS_RUNDIR/dpdkvhostclient0,queues=2,server=1" \
    --vdev="net_tap0,iface=tap0" --file-prefix page0 \
    --single-file-segments -- -a --nb-cores 2 --rxq 2 --txq 2 \
    >$OVS_RUNDIR/testpmd-dpdkvhostuserclient0.log 2>&1 &

printf "%s\n" "system-dpdk.at:211" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:211"
      printf "%s\n" "system-dpdk.at:211" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:211"
   ovs_wait_cond () {
    grep "virtio is now ready for processing" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:211" "until grep \"virtio is now ready for processing\" ovs-vswitchd.log"

printf "%s\n" "system-dpdk.at:212" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:212"
      printf "%s\n" "system-dpdk.at:212" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:212"
   ovs_wait_cond () {
    ip link show dev tap0 | grep -qw LOWER_UP
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:212" "until ip link show dev tap0 | grep -qw LOWER_UP"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:215: ps aux | grep testpmd"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:215"
( $at_check_trace; ps aux | grep testpmd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:215"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:216: ip link show"
at_fn_check_prepare_trace "system-dpdk.at:216"
( $at_check_trace; ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:216"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:217: ip link set tap0 netns ns1"
at_fn_check_prepare_trace "system-dpdk.at:217"
( $at_check_trace; ip link set tap0 netns ns1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:217"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:219: ip netns exec ns1 ip link show"
at_fn_check_prepare_trace "system-dpdk.at:219"
( $at_check_trace; ip netns exec ns1 ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:219"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:220: ip netns exec ns1 ip link show | grep tap0"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:220"
( $at_check_trace; ip netns exec ns1 ip link show | grep tap0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:220"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:221: ip netns exec ns1 ip link set tap0 up"
at_fn_check_prepare_trace "system-dpdk.at:221"
( $at_check_trace; ip netns exec ns1 ip link set tap0 up
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:221"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:222: ip netns exec ns1 ip addr add 172.31.110.11/24 dev tap0"
at_fn_check_prepare_trace "system-dpdk.at:222"
( $at_check_trace; ip netns exec ns1 ip addr add 172.31.110.11/24 dev tap0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:222"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:225: ip netns exec ns1 ip link show"
at_fn_check_prepare_trace "system-dpdk.at:225"
( $at_check_trace; ip netns exec ns1 ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:225"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:226: ip netns exec ns2 ip link show"
at_fn_check_prepare_trace "system-dpdk.at:226"
( $at_check_trace; ip netns exec ns2 ip link show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:226"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:227: ip netns exec ns1 ping -i 0.1 -c 10 -I tap0 172.31.110.12"
at_fn_check_prepare_trace "system-dpdk.at:227"
( $at_check_trace; ip netns exec ns1 ping -i 0.1 -c 10 -I tap0 172.31.110.12
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:227"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:230: ip netns exec ns1 ip link set tap0 down"
at_fn_check_prepare_trace "system-dpdk.at:230"
( $at_check_trace; ip netns exec ns1 ip link set tap0 down
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:230"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


# Wait for stats to be queried ("stats-update-interval")
sleep 5
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:234: ovs-vsctl get interface dpdkvhostuserclient0 statistics"
at_fn_check_prepare_trace "system-dpdk.at:234"
( $at_check_trace; ovs-vsctl get interface dpdkvhostuserclient0 statistics
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:234"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:236: test \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_packets\` -gt 0 -a                \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_bytes\` -gt 0"
at_fn_check_prepare_notrace 'a `...` command substitution' "system-dpdk.at:236"
( $at_check_trace; test `ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_packets` -gt 0 -a                `ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_bytes` -gt 0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:236"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:238: test \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_packets\` -eq                \$((\`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q0_good_packets\` +                   \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q1_good_packets\`))"
at_fn_check_prepare_notrace 'a `...` command substitution' "system-dpdk.at:238"
( $at_check_trace; test `ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_packets` -eq                $((`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q0_good_packets` +                   `ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q1_good_packets`))
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:238"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:241: test \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_bytes\` -eq                \$((\`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q0_good_bytes\` +                   \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q1_good_bytes\`))"
at_fn_check_prepare_notrace 'a `...` command substitution' "system-dpdk.at:241"
( $at_check_trace; test `ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_bytes` -eq                $((`ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q0_good_bytes` +                   `ovs-vsctl get interface dpdkvhostuserclient0 statistics:rx_q1_good_bytes`))
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:241"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:245: test \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_packets\` -gt 0 -a                \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_bytes\` -gt 0"
at_fn_check_prepare_notrace 'a `...` command substitution' "system-dpdk.at:245"
( $at_check_trace; test `ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_packets` -gt 0 -a                `ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_bytes` -gt 0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:245"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:247: test \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_packets\` -eq                \$((\`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q0_good_packets\` +                   \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q1_good_packets\`))"
at_fn_check_prepare_notrace 'a `...` command substitution' "system-dpdk.at:247"
( $at_check_trace; test `ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_packets` -eq                $((`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q0_good_packets` +                   `ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q1_good_packets`))
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:247"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:250: test \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_bytes\` -eq                \$((\`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q0_good_bytes\` +                   \`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q1_good_bytes\`))"
at_fn_check_prepare_notrace 'a `...` command substitution' "system-dpdk.at:250"
( $at_check_trace; test `ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_bytes` -eq                $((`ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q0_good_bytes` +                   `ovs-vsctl get interface dpdkvhostuserclient0 statistics:tx_q1_good_bytes`))
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:250"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


pkill -f -x -9 'tail -f /dev/null'

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:258: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:258"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:258"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:259: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) recvmsg failed@d
\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\\@dpdkvhostuser ports are considered deprecated;  please migrate to dpdkvhostuserclient ports.@d
\\@failed to enumerate system datapaths: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:259"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) recvmsg failed@d
\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\@dpdkvhostuser ports are considered deprecated;  please migrate to dpdkvhostuserclient ports.@d
\@failed to enumerate system datapaths: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:259: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:259"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:259: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:259"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:259" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:259"
      printf "%s\n" "system-dpdk.at:259" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:259"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:259" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:259: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:259"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:259: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:259"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:259"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:259" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:259"
      printf "%s\n" "system-dpdk.at:259" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:259"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:259" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_5
#AT_START_6
at_fn_group_banner 6 'system-dpdk.at:272' \
  "OVS-DPDK - Ingress policing create delete phy port" "" 1
at_xfail=no
(
  printf "%s\n" "6. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:275: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:275"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:275"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:275" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:275"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:275: mount"
at_fn_check_prepare_trace "system-dpdk.at:275"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:275"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:275: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:275"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:275"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:275" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:275"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:275: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:275"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:275"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:275: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:275"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:275"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:275" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:275"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:276"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:276"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:276"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:276"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:276"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:276"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:276"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:276: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:276"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:276"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:279: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:279"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:279"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:280: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:280"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:280"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:281: ovs-vsctl set interface phy0 ingress_policing_rate=10000 ingress_policing_burst=1000"
at_fn_check_prepare_trace "system-dpdk.at:281"
( $at_check_trace; ovs-vsctl set interface phy0 ingress_policing_rate=10000 ingress_policing_burst=1000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:281"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:282: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:282"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:282"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:286" >"$at_check_line_file"
(grep "Could not create rte meter for ingress policer" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:286"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:289: ovs-vsctl set interface phy0 ingress_policing_rate=0 ingress_policing_burst=0"
at_fn_check_prepare_trace "system-dpdk.at:289"
( $at_check_trace; ovs-vsctl set interface phy0 ingress_policing_rate=0 ingress_policing_burst=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:289"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:292: ovs-vsctl list interface phy0"
at_fn_check_prepare_trace "system-dpdk.at:292"
( $at_check_trace; ovs-vsctl list interface phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:292"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:293: grep -E 'ingress_policing_burst: 0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:293"
( $at_check_trace; grep -E 'ingress_policing_burst: 0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:293"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:295: ovs-vsctl list interface phy0"
at_fn_check_prepare_trace "system-dpdk.at:295"
( $at_check_trace; ovs-vsctl list interface phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:295"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:296: grep -E 'ingress_policing_rate: 0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:296"
( $at_check_trace; grep -E 'ingress_policing_rate: 0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:296"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:299: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:299"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:299"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:300: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:300"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:300: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:300"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:300: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:300"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:300" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:300"
      printf "%s\n" "system-dpdk.at:300" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:300"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:300" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:300: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:300"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:300: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:300"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:300"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:300" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:300"
      printf "%s\n" "system-dpdk.at:300" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:300"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:300" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_6
#AT_START_7
at_fn_group_banner 7 'system-dpdk.at:308' \
  "OVS-DPDK - Ingress policing create delete vport port" "" 1
at_xfail=no
(
  printf "%s\n" "7. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:311: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:311"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:311"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:311" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:311"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:311: mount"
at_fn_check_prepare_trace "system-dpdk.at:311"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:311"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:311: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:311"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:311"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:312"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:312"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:312"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:312"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:312"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:312"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:312"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:312: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:312"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:312"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:315: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:315"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:315"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:316: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:316"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:316"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:317: ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_rate=10000 ingress_policing_burst=1000"
at_fn_check_prepare_trace "system-dpdk.at:317"
( $at_check_trace; ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_rate=10000 ingress_policing_burst=1000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:317"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:318: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:318"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:318"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:322" >"$at_check_line_file"
(grep "Could not create rte meter for ingress policer" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:322"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:325: ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_rate=0 ingress_policing_burst=0"
at_fn_check_prepare_trace "system-dpdk.at:325"
( $at_check_trace; ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_rate=0 ingress_policing_burst=0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:325"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:328: ovs-vsctl list interface dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:328"
( $at_check_trace; ovs-vsctl list interface dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:328"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:329: grep -E 'ingress_policing_burst: 0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:329"
( $at_check_trace; grep -E 'ingress_policing_burst: 0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:329"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:331: ovs-vsctl list interface dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:331"
( $at_check_trace; ovs-vsctl list interface dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:331"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:332: grep -E 'ingress_policing_rate: 0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:332"
( $at_check_trace; grep -E 'ingress_policing_rate: 0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:332"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:335: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:335"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:335"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:336: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:336"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:336"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:337: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:337"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:337"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:340: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:340"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:340"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:341: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:341"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:341: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:341"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:341: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:341"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:341" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:341"
      printf "%s\n" "system-dpdk.at:341" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:341"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:341" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:341: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:341"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:341: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:341"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:341"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:341" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:341"
      printf "%s\n" "system-dpdk.at:341" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:341"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:341" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_7
#AT_START_8
at_fn_group_banner 8 'system-dpdk.at:351' \
  "OVS-DPDK - Ingress policing no policing rate" "   " 1
at_xfail=no
(
  printf "%s\n" "8. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:354: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:354"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:354"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:354" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:354"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:354: mount"
at_fn_check_prepare_trace "system-dpdk.at:354"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:354"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:354: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:354"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:354"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:355"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:355"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:355"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:355"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:355"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:355"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:355"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:355: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:355"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:355"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:358: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:358"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:358"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:359: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:359"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:359"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:360: ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_burst=1000"
at_fn_check_prepare_trace "system-dpdk.at:360"
( $at_check_trace; ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_burst=1000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:360"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:361: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:361"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:361"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:365" >"$at_check_line_file"
(grep "Could not create rte meter for ingress policer" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:365"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:368: ovs-vsctl list interface dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:368"
( $at_check_trace; ovs-vsctl list interface dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:368"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:369: grep -E 'ingress_policing_burst: 1000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:369"
( $at_check_trace; grep -E 'ingress_policing_burst: 1000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:369"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:371: ovs-vsctl list interface dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:371"
( $at_check_trace; ovs-vsctl list interface dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:371"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:372: grep -E 'ingress_policing_rate: 0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:372"
( $at_check_trace; grep -E 'ingress_policing_rate: 0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:372"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:376: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:376"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:376"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:377: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:377"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:377"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:378: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:378"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:378"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:381: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:381"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:381"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:382: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:382"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:382"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:382: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:382"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:382"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:382: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:382"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:382"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:382" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:382"
      printf "%s\n" "system-dpdk.at:382" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:382"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:382" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:382: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:382"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:382"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:382: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:382"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:382"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:382" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:382"
      printf "%s\n" "system-dpdk.at:382" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:382"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:382" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_8
#AT_START_9
at_fn_group_banner 9 'system-dpdk.at:392' \
  "OVS-DPDK - Ingress policing no policing burst" "  " 1
at_xfail=no
(
  printf "%s\n" "9. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:395: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:395"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:395"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:395" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:395"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:395: mount"
at_fn_check_prepare_trace "system-dpdk.at:395"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:395"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:395: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:395"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:395"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:396"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:396"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:396"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:396"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:396"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:396"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:396"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:396: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:396"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:396"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:399: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:399"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:399"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:400: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:400"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:400"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:401: ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_rate=10000"
at_fn_check_prepare_trace "system-dpdk.at:401"
( $at_check_trace; ovs-vsctl set interface dpdkvhostuserclient0 ingress_policing_rate=10000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:401"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:402: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:402"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:402"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:406" >"$at_check_line_file"
(grep "Could not create rte meter for ingress policer" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:406"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:409: ovs-vsctl list interface dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:409"
( $at_check_trace; ovs-vsctl list interface dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:409"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:410: grep -E 'ingress_policing_burst: 0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:410"
( $at_check_trace; grep -E 'ingress_policing_burst: 0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:410"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:412: ovs-vsctl list interface dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:412"
( $at_check_trace; ovs-vsctl list interface dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:412"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:413: grep -E 'ingress_policing_rate: 10000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:413"
( $at_check_trace; grep -E 'ingress_policing_rate: 10000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:413"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:416: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:416"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:416"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:417: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:417"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:417"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:418: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:418"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:418"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:421: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:421"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:421"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:422: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:422"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:422: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:422"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:422: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:422"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:422" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:422"
      printf "%s\n" "system-dpdk.at:422" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:422"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:422" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:422: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:422"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:422: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:422"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:422"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:422" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:422"
      printf "%s\n" "system-dpdk.at:422" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:422"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:422" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_9
#AT_START_10
at_fn_group_banner 10 'system-dpdk.at:431' \
  "OVS-DPDK - QoS create delete phy port" "          " 1
at_xfail=no
(
  printf "%s\n" "10. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:434: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:434"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:434" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:434"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:434: mount"
at_fn_check_prepare_trace "system-dpdk.at:434"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:434: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:434"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:434" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:434"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:434: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:434"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:434: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:434"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:434" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:434"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:435"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:435"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:435"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:435"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:435"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:435"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:435"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:435: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:435"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:435"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:438: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:438"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:438"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:439: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:439"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:439"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:440" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:440"
      printf "%s\n" "system-dpdk.at:440" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:440"
   ovs_wait_cond () {
    ovs-vsctl set port phy0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cir=1250000 other-config:cbs=2048
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:440" "until ovs-vsctl set port phy0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cir=1250000 other-config:cbs=2048"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:441: ovs-appctl -t ovs-vswitchd qos/show phy0"
at_fn_check_prepare_trace "system-dpdk.at:441"
( $at_check_trace; ovs-appctl -t ovs-vswitchd qos/show phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:441"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:445" >"$at_check_line_file"
(grep "Could not create rte meter for egress policer" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:445"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:448: ovs-vsctl destroy QoS phy0 -- clear Port phy0 qos"
at_fn_check_prepare_trace "system-dpdk.at:448"
( $at_check_trace; ovs-vsctl destroy QoS phy0 -- clear Port phy0 qos
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:448"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:451: ovs-appctl -t ovs-vswitchd qos/show phy0"
at_fn_check_prepare_trace "system-dpdk.at:451"
( $at_check_trace; ovs-appctl -t ovs-vswitchd qos/show phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:451"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:452: grep -E 'QoS not configured on phy0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:452"
( $at_check_trace; grep -E 'QoS not configured on phy0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:452"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:455: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:455"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:455"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:456: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:456"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:456: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:456"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:456: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:456"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:456" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:456"
      printf "%s\n" "system-dpdk.at:456" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:456"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:456" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:456: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:456"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:456: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:456"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:456"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:456" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:456"
      printf "%s\n" "system-dpdk.at:456" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:456"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:456" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_10
#AT_START_11
at_fn_group_banner 11 'system-dpdk.at:464' \
  "OVS-DPDK - QoS create delete vport port" "        " 1
at_xfail=no
(
  printf "%s\n" "11. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:467: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:467"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:467"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:467" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:467"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:467: mount"
at_fn_check_prepare_trace "system-dpdk.at:467"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:467"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:467: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:467"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:467"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:468"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:468"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:468"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:468"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:468"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:468"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:468"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:468: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:468"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:468"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:471: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:471"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:471"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:472: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:472"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:472"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:473" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:473"
      printf "%s\n" "system-dpdk.at:473" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:473"
   ovs_wait_cond () {
    ovs-vsctl set port dpdkvhostuserclient0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cir=1250000 \
                  other-config:cbs=2048
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:473" "until ovs-vsctl set port dpdkvhostuserclient0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cir=1250000 \\
                  other-config:cbs=2048"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:475: ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:475"
( $at_check_trace; ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:475"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:479: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:479"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:479"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:480: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:480"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:480"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:481: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:481"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:481"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


printf "%s\n" "system-dpdk.at:484" >"$at_check_line_file"
(grep "Could not create rte meter for egress policer" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:484"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:487: ovs-vsctl destroy QoS dpdkvhostuserclient0 -- clear Port dpdkvhostuserclient0 qos"
at_fn_check_prepare_trace "system-dpdk.at:487"
( $at_check_trace; ovs-vsctl destroy QoS dpdkvhostuserclient0 -- clear Port dpdkvhostuserclient0 qos
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:487"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:490: ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:490"
( $at_check_trace; ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:490"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:491: grep -E 'QoS not configured on dpdkvhostuserclient0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:491"
( $at_check_trace; grep -E 'QoS not configured on dpdkvhostuserclient0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:491"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:494: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:494"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:494"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:495: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:495"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:495: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:495"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:495: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:495"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:495" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:495"
      printf "%s\n" "system-dpdk.at:495" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:495"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:495" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:495: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:495"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:495: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:495"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:495"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:495" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:495"
      printf "%s\n" "system-dpdk.at:495" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:495"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:495" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_11
#AT_START_12
at_fn_group_banner 12 'system-dpdk.at:505' \
  "OVS-DPDK - QoS no cir" "                          " 1
at_xfail=no
(
  printf "%s\n" "12. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:508: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:508"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:508"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:508" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:508"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:508: mount"
at_fn_check_prepare_trace "system-dpdk.at:508"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:508"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:508: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:508"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:508"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:509"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:509"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:509"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:509"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:509"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:509"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:509"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:509: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:509"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:509"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:512: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:512"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:512"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:513: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:513"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:513"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:514" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:514"
      printf "%s\n" "system-dpdk.at:514" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:514"
   ovs_wait_cond () {
    ovs-vsctl set port dpdkvhostuserclient0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cbs=2048
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:514" "until ovs-vsctl set port dpdkvhostuserclient0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cbs=2048"

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:518: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:518"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:518"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:519: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:519"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:519"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:520: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:520"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:520"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:523: ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:523"
( $at_check_trace; ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:523"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:524: grep -E 'QoS not configured on dpdkvhostuserclient0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:524"
( $at_check_trace; grep -E 'QoS not configured on dpdkvhostuserclient0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:524"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:527: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:527"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:527"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:528: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\\@Could not create rte meter for egress policer@d
\\@Failed to set QoS type egress-policer on port dpdkvhostuserclient0: Invalid argument@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:528"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\@Could not create rte meter for egress policer@d
\@Failed to set QoS type egress-policer on port dpdkvhostuserclient0: Invalid argument@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:528: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:528"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:528: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:528"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:528" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:528"
      printf "%s\n" "system-dpdk.at:528" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:528"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:528" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:528: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:528"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:528: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:528"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:528"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:528" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:528"
      printf "%s\n" "system-dpdk.at:528" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:528"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:528" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_12
#AT_START_13
at_fn_group_banner 13 'system-dpdk.at:540' \
  "OVS-DPDK - QoS no cbs" "                          " 1
at_xfail=no
(
  printf "%s\n" "13. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:543: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:543"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:543"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:543" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:543"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:543: mount"
at_fn_check_prepare_trace "system-dpdk.at:543"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:543"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:543: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:543"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:543"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:544"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:544"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:544"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:544"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:544"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:544"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:544"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:544: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:544"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:544"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:547: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:547"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:547"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:548: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:548"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:548"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:549" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:549"
      printf "%s\n" "system-dpdk.at:549" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:549"
   ovs_wait_cond () {
    ovs-vsctl set port dpdkvhostuserclient0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cir=1250000
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:549" "until ovs-vsctl set port dpdkvhostuserclient0 qos=@newqos -- --id=@newqos create qos type=egress-policer other-config:cir=1250000"

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:553: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:553"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:553"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:554: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:554"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:554"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:555: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:555"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:555"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:558: ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:558"
( $at_check_trace; ovs-appctl -t ovs-vswitchd qos/show dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:558"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:559: grep -E 'QoS not configured on dpdkvhostuserclient0' stdout"
at_fn_check_prepare_trace "system-dpdk.at:559"
( $at_check_trace; grep -E 'QoS not configured on dpdkvhostuserclient0' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:559"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:562: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:562"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:562"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:563: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\\@Could not create rte meter for egress policer@d
\\@Failed to set QoS type egress-policer on port dpdkvhostuserclient0: Invalid argument@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:563"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\@Could not create rte meter for egress policer@d
\@Failed to set QoS type egress-policer on port dpdkvhostuserclient0: Invalid argument@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:563: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:563"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:563: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:563"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:563" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:563"
      printf "%s\n" "system-dpdk.at:563" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:563"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:563" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:563: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:563"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:563: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:563"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:563"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:563" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:563"
      printf "%s\n" "system-dpdk.at:563" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:563"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:563" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_13
#AT_START_14
at_fn_group_banner 14 'system-dpdk.at:576' \
  "OVS-DPDK - MTU increase phy port" "               " 1
at_xfail=no
(
  printf "%s\n" "14. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:579: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:579"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:579"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:579" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:579"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:579: mount"
at_fn_check_prepare_trace "system-dpdk.at:579"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:579"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:579: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:579"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:579"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:579" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:579"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:579: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:579"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:579"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:579: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:579"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:579"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:579" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:579"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:580"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:580"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:580"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:580"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:580"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:580"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:580"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:580: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:580"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:580"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"




{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:585: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:585"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:585"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:586: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:586"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:586"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:587: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:587"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:587"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:591: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:591"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:591"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:592: grep -E 'mtu=1500' stdout"
at_fn_check_prepare_trace "system-dpdk.at:592"
( $at_check_trace; grep -E 'mtu=1500' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:592"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:595: ovs-vsctl set Interface phy0 mtu_request=9000"
at_fn_check_prepare_trace "system-dpdk.at:595"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=9000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:595"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


printf "%s\n" "system-dpdk.at:598" >"$at_check_line_file"
(grep "Interface phy0 does not support MTU configuration" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:598"

printf "%s\n" "system-dpdk.at:601" >"$at_check_line_file"
(grep "Interface phy0 MTU (9000) setup error" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:601"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:603: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:603"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:603"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:604: grep -E 'mtu=9000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:604"
( $at_check_trace; grep -E 'mtu=9000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:604"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:608: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:608"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:608"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:609: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:609"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:609"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:609: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:609"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:609"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:609: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:609"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:609"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:609" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:609"
      printf "%s\n" "system-dpdk.at:609" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:609"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:609" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:609: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:609"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:609"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:609: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:609"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:609"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:609" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:609"
      printf "%s\n" "system-dpdk.at:609" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:609"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:609" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_14
#AT_START_15
at_fn_group_banner 15 'system-dpdk.at:617' \
  "OVS-DPDK - MTU decrease phy port" "               " 1
at_xfail=no
(
  printf "%s\n" "15. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:620: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:620"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:620"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:620" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:620"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:620: mount"
at_fn_check_prepare_trace "system-dpdk.at:620"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:620"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:620: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:620"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:620"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:620" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:620"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:620: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:620"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:620"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:620: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:620"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:620"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:620" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:620"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:621"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:621"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:621"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:621"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:621"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:621"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:621"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:621: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:621"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:621"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"




{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:626: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:626"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:626"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:627: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:627"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:627"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:628: ovs-vsctl set Interface phy0 mtu_request=9000"
at_fn_check_prepare_trace "system-dpdk.at:628"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=9000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:628"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:629: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:629"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:629"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:633" >"$at_check_line_file"
(grep "Interface phy0 does not support MTU configuration" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:633"

printf "%s\n" "system-dpdk.at:636" >"$at_check_line_file"
(grep "Interface phy0 MTU (9000) setup error" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:636"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:639: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:639"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:639"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:640: grep -E 'mtu=9000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:640"
( $at_check_trace; grep -E 'mtu=9000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:640"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:643: ovs-vsctl set Interface phy0 mtu_request=2000"
at_fn_check_prepare_trace "system-dpdk.at:643"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=2000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:643"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:645: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:645"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:645"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:646: grep -E 'mtu=2000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:646"
( $at_check_trace; grep -E 'mtu=2000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:646"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:650: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:650"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:650"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:651: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:651"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:651: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:651"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:651: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:651"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:651" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:651"
      printf "%s\n" "system-dpdk.at:651" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:651"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:651" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:651: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:651"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:651: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:651"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:651"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:651" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:651"
      printf "%s\n" "system-dpdk.at:651" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:651"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:651" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_15
#AT_START_16
at_fn_group_banner 16 'system-dpdk.at:659' \
  "OVS-DPDK - MTU increase vport port" "             " 1
at_xfail=no
(
  printf "%s\n" "16. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



printf "%s\n" "system-dpdk.at:662" >"$at_check_line_file"
(! which dpdk-testpmd >/dev/null 2>/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:662"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:663: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:663"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:663"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:663" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:663"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:663: mount"
at_fn_check_prepare_trace "system-dpdk.at:663"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:663"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:663: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:663"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:663"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:664"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:664"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:664"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:664"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:664"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:664"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:664"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:664: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:664"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:664"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:667: lscpu"
at_fn_check_prepare_trace "system-dpdk.at:667"
( $at_check_trace; lscpu
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:667"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:668: cat stdout | grep \"NUMA node(s)\" | awk '{c=1; while (c++<\$(3)) {printf \"512,\"}; print \"512\"}' > NUMA_NODE"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:668"
( $at_check_trace; cat stdout | grep "NUMA node(s)" | awk '{c=1; while (c++<$(3)) {printf "512,"}; print "512"}' > NUMA_NODE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:668"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:671: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:671"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:671"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:672: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:672"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:672"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:673: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:673"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:673"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:677: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:677"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:677"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:678: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:678"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:678"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:679: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:679"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:679"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


on_exit "pkill -f -x -9 'tail -f /dev/null'"
tail -f /dev/null | dpdk-testpmd --socket-mem="$(cat NUMA_NODE)" --no-pci\
           --vdev="net_virtio_user,path=$OVS_RUNDIR/dpdkvhostclient0,server=1" \
           --vdev="net_tap0,iface=tap0" --file-prefix page0 \
           --single-file-segments -- -a >$OVS_RUNDIR/testpmd-dpdkvhostuserclient0.log 2>&1 &

printf "%s\n" "system-dpdk.at:688" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:688"
      printf "%s\n" "system-dpdk.at:688" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:688"
   ovs_wait_cond () {
    grep "virtio is now ready for processing" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:688" "until grep \"virtio is now ready for processing\" ovs-vswitchd.log"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:691: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:691"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:691"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:692: grep -E 'mtu=1500' stdout"
at_fn_check_prepare_trace "system-dpdk.at:692"
( $at_check_trace; grep -E 'mtu=1500' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:692"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:695: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9000"
at_fn_check_prepare_trace "system-dpdk.at:695"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:695"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:697: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:697"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:697"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:698: grep -E 'mtu=9000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:698"
( $at_check_trace; grep -E 'mtu=9000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:698"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


pkill -f -x -9 'tail -f /dev/null'

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:704: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:704"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:704"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:705: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:705"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:705"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:705: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:705"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:705"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:705: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:705"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:705"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:705" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:705"
      printf "%s\n" "system-dpdk.at:705" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:705"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:705" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:705: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:705"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:705"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:705: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:705"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:705"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:705" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:705"
      printf "%s\n" "system-dpdk.at:705" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:705"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:705" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_16
#AT_START_17
at_fn_group_banner 17 'system-dpdk.at:715' \
  "OVS-DPDK - MTU decrease vport port" "             " 1
at_xfail=no
(
  printf "%s\n" "17. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



printf "%s\n" "system-dpdk.at:718" >"$at_check_line_file"
(! which dpdk-testpmd >/dev/null 2>/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:718"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:719: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:719"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:719"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:719" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:719"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:719: mount"
at_fn_check_prepare_trace "system-dpdk.at:719"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:719"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:719: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:719"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:719"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:720"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:720"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:720"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:720"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:720"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:720"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:720"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:720: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:720"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:720"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:723: lscpu"
at_fn_check_prepare_trace "system-dpdk.at:723"
( $at_check_trace; lscpu
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:723"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:724: cat stdout | grep \"NUMA node(s)\" | awk '{c=1; while (c++<\$(3)) {printf \"512,\"}; print \"512\"}' > NUMA_NODE"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:724"
( $at_check_trace; cat stdout | grep "NUMA node(s)" | awk '{c=1; while (c++<$(3)) {printf "512,"}; print "512"}' > NUMA_NODE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:724"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:727: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:727"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:727"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:728: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:728"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:728"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:729: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9000"
at_fn_check_prepare_trace "system-dpdk.at:729"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:729"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:730: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:730"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:730"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:734: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:734"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:734"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:735: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:735"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:735"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:736: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:736"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:736"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


on_exit "pkill -f -x -9 'tail -f /dev/null'"
tail -f /dev/null | dpdk-testpmd --socket-mem="$(cat NUMA_NODE)" --no-pci\
           --vdev="net_virtio_user,path=$OVS_RUNDIR/dpdkvhostclient0,server=1" \
           --vdev="net_tap0,iface=tap0" --file-prefix page0 \
           --single-file-segments -- -a >$OVS_RUNDIR/testpmd-dpdkvhostuserclient0.log 2>&1 &

printf "%s\n" "system-dpdk.at:745" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:745"
      printf "%s\n" "system-dpdk.at:745" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:745"
   ovs_wait_cond () {
    grep "virtio is now ready for processing" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:745" "until grep \"virtio is now ready for processing\" ovs-vswitchd.log"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:748: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:748"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:748"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:749: grep -E 'mtu=9000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:749"
( $at_check_trace; grep -E 'mtu=9000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:749"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:752: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=2000"
at_fn_check_prepare_trace "system-dpdk.at:752"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=2000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:752"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:754: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:754"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:754"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:755: grep -E 'mtu=2000' stdout"
at_fn_check_prepare_trace "system-dpdk.at:755"
( $at_check_trace; grep -E 'mtu=2000' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:755"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


pkill -f -x -9 'tail -f /dev/null'

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:761: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:761"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:761"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:762: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:762"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:762: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:762"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:762: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:762"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:762" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:762"
      printf "%s\n" "system-dpdk.at:762" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:762"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:762" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:762: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:762"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:762: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:762"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:762"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:762" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:762"
      printf "%s\n" "system-dpdk.at:762" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:762"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:762" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_17
#AT_START_18
at_fn_group_banner 18 'system-dpdk.at:772' \
  "OVS-DPDK - MTU upper bound phy port" "            " 1
at_xfail=no
(
  printf "%s\n" "18. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:775: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:775"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:775"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:775" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:775"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:775: mount"
at_fn_check_prepare_trace "system-dpdk.at:775"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:775"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:775: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:775"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:775"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:775" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:775"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:775: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:775"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:775"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:775: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:775"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:775"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:775" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:775"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:776"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:776"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:776"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:776"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:776"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:776"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:776"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:776: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:776"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:776"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:779: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:779"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:779"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:780: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:780"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:780"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:781: ovs-vsctl set Interface phy0 mtu_request=9702"
at_fn_check_prepare_trace "system-dpdk.at:781"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=9702
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:781"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:782: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:782"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:782"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:786" >"$at_check_line_file"
(grep "Interface phy0 does not support MTU configuration" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:786"

printf "%s\n" "system-dpdk.at:789" >"$at_check_line_file"
(grep "Interface phy0 MTU (9702) setup error" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:789"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:792: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:792"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:792"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:793: grep -E 'mtu=9702' stdout"
at_fn_check_prepare_trace "system-dpdk.at:793"
( $at_check_trace; grep -E 'mtu=9702' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:793"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:796: ovs-vsctl set Interface phy0 mtu_request=9711"
at_fn_check_prepare_trace "system-dpdk.at:796"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=9711
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:796"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:797: grep \"phy0: unsupported MTU 9711\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:797"
( $at_check_trace; grep "phy0: unsupported MTU 9711" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:797"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:801: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:801"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:801"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:802: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@phy0: unsupported MTU 9711@d
\\@failed to set MTU for network device phy0: Invalid argument@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:802"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@phy0: unsupported MTU 9711@d
\@failed to set MTU for network device phy0: Invalid argument@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:802: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:802"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:802: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:802"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:802" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:802"
      printf "%s\n" "system-dpdk.at:802" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:802"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:802" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:802: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:802"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:802: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:802"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:802"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:802" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:802"
      printf "%s\n" "system-dpdk.at:802" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:802"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:802" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_18
#AT_START_19
at_fn_group_banner 19 'system-dpdk.at:813' \
  "OVS-DPDK - MTU lower bound phy port" "            " 1
at_xfail=no
(
  printf "%s\n" "19. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:816: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:816"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:816"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:816" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:816"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:816: mount"
at_fn_check_prepare_trace "system-dpdk.at:816"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:816"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:816: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:816"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:816"
$at_failed && at_fn_log_failure
$at_traceon; }




      printf "%s\n" "system-dpdk.at:816" >"$at_check_line_file"
( ! (lsmod | grep -E "igb_uio|vfio") ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:816"

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:816: \$DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:816"
( $at_check_trace; $DPDK_DIR/usertools/dpdk-devbind.py -s | head -n +4 | tail -1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:816"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:816: cat stdout | cut -d\" \" -s -f1 > PCI_ADDR"
at_fn_check_prepare_notrace 'a shell pipeline' "system-dpdk.at:816"
( $at_check_trace; cat stdout | cut -d" " -s -f1 > PCI_ADDR
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:816"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:816" >"$at_check_line_file"
( ! test -s PCI_ADDR ) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:816"


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:817"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:817"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:817"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:817"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:817"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:817"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error \""
at_fn_check_prepare_trace "system-dpdk.at:817"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error "
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:817: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:817"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:817"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:820: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:820"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:820"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:821: ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=\$(cat PCI_ADDR)"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:821"
( $at_check_trace; ovs-vsctl add-port br10 phy0 -- set Interface phy0 type=dpdk options:dpdk-devargs=$(cat PCI_ADDR)
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:821"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:822: ovs-vsctl set Interface phy0 mtu_request=68"
at_fn_check_prepare_trace "system-dpdk.at:822"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=68
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:822"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:823: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:823"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:823"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

printf "%s\n" "system-dpdk.at:827" >"$at_check_line_file"
(grep "Interface phy0 does not support MTU configuration" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:827"

printf "%s\n" "system-dpdk.at:830" >"$at_check_line_file"
(grep "Interface phy0 MTU (68) setup error" ovs-vswitchd.log) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:830"

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:833: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:833"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:833"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:834: grep -E 'mtu=68' stdout"
at_fn_check_prepare_trace "system-dpdk.at:834"
( $at_check_trace; grep -E 'mtu=68' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:834"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:837: ovs-vsctl set Interface phy0 mtu_request=67"
at_fn_check_prepare_trace "system-dpdk.at:837"
( $at_check_trace; ovs-vsctl set Interface phy0 mtu_request=67
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:837"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:838: grep \"phy0: unsupported MTU 67\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:838"
( $at_check_trace; grep "phy0: unsupported MTU 67" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:838"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:842: ovs-vsctl del-port br10 phy0"
at_fn_check_prepare_trace "system-dpdk.at:842"
( $at_check_trace; ovs-vsctl del-port br10 phy0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:842"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:843: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@phy0: unsupported MTU 67@d
\\@failed to set MTU for network device phy0: Invalid argument@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:843"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@phy0: unsupported MTU 67@d
\@failed to set MTU for network device phy0: Invalid argument@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:843: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:843"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:843: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:843"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:843" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:843"
      printf "%s\n" "system-dpdk.at:843" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:843"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:843" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:843: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:843"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:843: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:843"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:843"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:843" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:843"
      printf "%s\n" "system-dpdk.at:843" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:843"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:843" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_19
#AT_START_20
at_fn_group_banner 20 'system-dpdk.at:854' \
  "OVS-DPDK - MTU upper bound vport port" "          " 1
at_xfail=no
(
  printf "%s\n" "20. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



printf "%s\n" "system-dpdk.at:857" >"$at_check_line_file"
(! which dpdk-testpmd >/dev/null 2>/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:857"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:858: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:858"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:858"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:858" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:858"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:858: mount"
at_fn_check_prepare_trace "system-dpdk.at:858"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:858"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:858: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:858"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:858"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:859"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:859"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:859"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:859"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:859"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:859"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:859"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:859: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:859"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:859"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:862: lscpu"
at_fn_check_prepare_trace "system-dpdk.at:862"
( $at_check_trace; lscpu
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:862"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:863: cat stdout | grep \"NUMA node(s)\" | awk '{c=1; while (c++<\$(3)) {printf \"512,\"}; print \"512\"}' > NUMA_NODE"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:863"
( $at_check_trace; cat stdout | grep "NUMA node(s)" | awk '{c=1; while (c++<$(3)) {printf "512,"}; print "512"}' > NUMA_NODE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:863"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:866: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:866"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:866"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:867: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:867"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:867"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:868: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9702"
at_fn_check_prepare_trace "system-dpdk.at:868"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9702
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:868"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:869: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:869"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:869"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

on_exit "pkill -f -x -9 'tail -f /dev/null'"
tail -f /dev/null | dpdk-testpmd --socket-mem="$(cat NUMA_NODE)" --no-pci\
           --vdev="net_virtio_user,path=$OVS_RUNDIR/dpdkvhostclient0,server=1" \
           --vdev="net_tap0,iface=tap0" --file-prefix page0 \
           --single-file-segments -- -a >$OVS_RUNDIR/testpmd-dpdkvhostuserclient0.log 2>&1 &

printf "%s\n" "system-dpdk.at:879" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:879"
      printf "%s\n" "system-dpdk.at:879" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:879"
   ovs_wait_cond () {
    grep "virtio is now ready for processing" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:879" "until grep \"virtio is now ready for processing\" ovs-vswitchd.log"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:882: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:882"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:882"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:883: grep -E 'mtu=9702' stdout"
at_fn_check_prepare_trace "system-dpdk.at:883"
( $at_check_trace; grep -E 'mtu=9702' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:883"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:886: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9711"
at_fn_check_prepare_trace "system-dpdk.at:886"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=9711
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:886"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:887: grep \"dpdkvhostuserclient0: unsupported MTU 9711\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:887"
( $at_check_trace; grep "dpdkvhostuserclient0: unsupported MTU 9711" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:887"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


pkill -f -x -9 'tail -f /dev/null'

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:893: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:893"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:893"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:894: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\\@dpdkvhostuserclient0: unsupported MTU 9711@d
\\@failed to set MTU for network device dpdkvhostuserclient0: Invalid argument@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:894"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\@dpdkvhostuserclient0: unsupported MTU 9711@d
\@failed to set MTU for network device dpdkvhostuserclient0: Invalid argument@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:894: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:894"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:894: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:894"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:894" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:894"
      printf "%s\n" "system-dpdk.at:894" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:894"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:894" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:894: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:894"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:894: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:894"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:894"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:894" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:894"
      printf "%s\n" "system-dpdk.at:894" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:894"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:894" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_20
#AT_START_21
at_fn_group_banner 21 'system-dpdk.at:906' \
  "OVS-DPDK - MTU lower bound vport port" "          " 1
at_xfail=no
(
  printf "%s\n" "21. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init



printf "%s\n" "system-dpdk.at:909" >"$at_check_line_file"
(! which dpdk-testpmd >/dev/null 2>/dev/null) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:909"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:910: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:910"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:910"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:910" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:910"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:910: mount"
at_fn_check_prepare_trace "system-dpdk.at:910"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:910"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:910: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:910"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:910"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:911"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:911"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:911"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:911"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:911"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:911"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:911"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:911: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:911"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:911"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:914: lscpu"
at_fn_check_prepare_trace "system-dpdk.at:914"
( $at_check_trace; lscpu
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:914"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:915: cat stdout | grep \"NUMA node(s)\" | awk '{c=1; while (c++<\$(3)) {printf \"512,\"}; print \"512\"}' > NUMA_NODE"
at_fn_check_prepare_notrace 'a $(...) command substitution' "system-dpdk.at:915"
( $at_check_trace; cat stdout | grep "NUMA node(s)" | awk '{c=1; while (c++<$(3)) {printf "512,"}; print "512"}' > NUMA_NODE
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:915"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:918: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:918"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:918"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:919: ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=\$OVS_RUNDIR/dpdkvhostclient0"
at_fn_check_prepare_dynamic "ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0" "system-dpdk.at:919"
( $at_check_trace; ovs-vsctl add-port br10 dpdkvhostuserclient0 -- set Interface dpdkvhostuserclient0 type=dpdkvhostuserclient options:vhost-server-path=$OVS_RUNDIR/dpdkvhostclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:919"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:920: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=68"
at_fn_check_prepare_trace "system-dpdk.at:920"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=68
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:920"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:921: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:921"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:921"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:925: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created\" ovs-vswitchd.log" "system-dpdk.at:925"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) vhost-user client: socket created" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:925"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:926: grep \"vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:926"
( $at_check_trace; grep "vHost User device 'dpdkvhostuserclient0' created in 'client' mode, using client socket" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:926"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:927: grep \"VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log"
at_fn_check_prepare_dynamic "grep \"VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting...\" ovs-vswitchd.log" "system-dpdk.at:927"
( $at_check_trace; grep "VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) reconnecting..." ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:927"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


on_exit "pkill -f -x -9 'tail -f /dev/null'"
tail -f /dev/null | dpdk-testpmd --socket-mem="$(cat NUMA_NODE)" --no-pci\
           --vdev="net_virtio_user,path=$OVS_RUNDIR/dpdkvhostclient0,server=1" \
           --vdev="net_tap0,iface=tap0" --file-prefix page0 \
           --single-file-segments -- -a >$OVS_RUNDIR/testpmd-dpdkvhostuserclient0.log 2>&1 &

printf "%s\n" "system-dpdk.at:936" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:936"
      printf "%s\n" "system-dpdk.at:936" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:936"
   ovs_wait_cond () {
    grep "virtio is now ready for processing" ovs-vswitchd.log
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:936" "until grep \"virtio is now ready for processing\" ovs-vswitchd.log"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:939: ovs-appctl dpctl/show"
at_fn_check_prepare_trace "system-dpdk.at:939"
( $at_check_trace; ovs-appctl dpctl/show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:939"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:940: grep -E 'mtu=68' stdout"
at_fn_check_prepare_trace "system-dpdk.at:940"
( $at_check_trace; grep -E 'mtu=68' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:940"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:943: ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=67"
at_fn_check_prepare_trace "system-dpdk.at:943"
( $at_check_trace; ovs-vsctl set Interface dpdkvhostuserclient0 mtu_request=67
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:943"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:944: grep \"dpdkvhostuserclient0: unsupported MTU 67\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:944"
( $at_check_trace; grep "dpdkvhostuserclient0: unsupported MTU 67" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:944"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


pkill -f -x -9 'tail -f /dev/null'

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:950: ovs-vsctl del-port br10 dpdkvhostuserclient0"
at_fn_check_prepare_trace "system-dpdk.at:950"
( $at_check_trace; ovs-vsctl del-port br10 dpdkvhostuserclient0
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:950"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:951: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@VHOST_CONFIG: (\$OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\\@dpdkvhostuserclient0: unsupported MTU 67@d
\\@failed to set MTU for network device dpdkvhostuserclient0: Invalid argument@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:951"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@VHOST_CONFIG: ($OVS_RUNDIR/dpdkvhostclient0) failed to connect: No such file or directory@d
\@dpdkvhostuserclient0: unsupported MTU 67@d
\@failed to set MTU for network device dpdkvhostuserclient0: Invalid argument@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:951: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:951"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:951: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:951"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:951" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:951"
      printf "%s\n" "system-dpdk.at:951" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:951"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:951" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:951: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:951"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:951: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:951"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:951"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:951" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:951"
      printf "%s\n" "system-dpdk.at:951" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:951"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:951" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_21
#AT_START_22
at_fn_group_banner 22 'system-dpdk.at:963' \
  "OVS-DPDK - MFEX Autovalidator" "                  " 1
at_xfail=no
(
  printf "%s\n" "22. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:965: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:965"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:965"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:965" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:965"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:965: mount"
at_fn_check_prepare_trace "system-dpdk.at:965"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:965"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:965: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:965"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:965"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:966"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:966"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:966"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:966"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:966"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:966"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:966"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:966: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:966"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:966"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:967: ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:967"
( $at_check_trace; ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:967"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:968" >"$at_check_line_file"
(! ovs-appctl dpif-netdev/miniflow-parser-get | sed 1,4d | grep "True") \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:968"

printf "%s\n" "system-dpdk.at:971" >"$at_check_line_file"
(! $PYTHON3 -c "import scapy") \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:971"
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:972: \$PYTHON3 \$srcdir/mfex_fuzzy.py test_traffic.pcap 2000"
at_fn_check_prepare_dynamic "$PYTHON3 $srcdir/mfex_fuzzy.py test_traffic.pcap 2000" "system-dpdk.at:972"
( $at_check_trace; $PYTHON3 $srcdir/mfex_fuzzy.py test_traffic.pcap 2000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:972"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:975: ovs-vsctl add-port br0 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_pcap1,rx_pcap=test_traffic.pcap,infinite_rx=1"
at_fn_check_prepare_trace "system-dpdk.at:975"
( $at_check_trace; ovs-vsctl add-port br0 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_pcap1,rx_pcap=test_traffic.pcap,infinite_rx=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:975"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:976: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:976"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:976"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:978: ovs-appctl dpif-netdev/dpif-impl-set dpif_avx512"
at_fn_check_prepare_trace "system-dpdk.at:978"
( $at_check_trace; ovs-appctl dpif-netdev/dpif-impl-set dpif_avx512
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "DPIF implementation set to dpif_avx512.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:978"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:982: ovs-appctl dpif-netdev/miniflow-parser-set autovalidator"
at_fn_check_prepare_trace "system-dpdk.at:982"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set autovalidator
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to autovalidator.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:982"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


printf "%s\n" "system-dpdk.at:986" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:986"
      printf "%s\n" "system-dpdk.at:986" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:986"
   ovs_wait_cond () {
    test `ovs-vsctl get interface p1 statistics | grep -oP 'rx_packets=\s*\K\d+'` -ge 16000
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:986" "until test \`ovs-vsctl get interface p1 statistics | grep -oP 'rx_packets=\\s*\\K\\d+'\` -ge 16000"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:989: ovs-vsctl del-port br0 p1"
at_fn_check_prepare_trace "system-dpdk.at:989"
( $at_check_trace; ovs-vsctl del-port br0 p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:989"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:990: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:990"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:990: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:990"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:990: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:990"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:990" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:990"
      printf "%s\n" "system-dpdk.at:990" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:990"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:990" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:990: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:990"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:990: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:990"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:990"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:990" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:990"
      printf "%s\n" "system-dpdk.at:990" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:990"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:990" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_22
#AT_START_23
at_fn_group_banner 23 'system-dpdk.at:996' \
  "OVS-DPDK - MFEX Autovalidator Fuzzy" "            " 1
at_xfail=no
(
  printf "%s\n" "23. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:998: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:998"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:998"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:998" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:998"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:998: mount"
at_fn_check_prepare_trace "system-dpdk.at:998"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:998"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:998: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:998"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:998"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:999"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:999"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:999"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:999"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:999"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:999"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:999"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:999: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:999"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:999"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1000: ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:1000"
( $at_check_trace; ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1000"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:1001" >"$at_check_line_file"
(! ovs-appctl dpif-netdev/miniflow-parser-get | sed 1,4d | grep "True") \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:1001"

printf "%s\n" "system-dpdk.at:1004" >"$at_check_line_file"
(! $PYTHON3 -c "import scapy") \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:1004"
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1005: \$PYTHON3 \$srcdir/mfex_fuzzy.py fuzzy.pcap 2000 fuzzy"
at_fn_check_prepare_dynamic "$PYTHON3 $srcdir/mfex_fuzzy.py fuzzy.pcap 2000 fuzzy" "system-dpdk.at:1005"
( $at_check_trace; $PYTHON3 $srcdir/mfex_fuzzy.py fuzzy.pcap 2000 fuzzy
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1005"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1008: ovs-vsctl add-port br0 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_pcap1,rx_pcap=fuzzy.pcap,infinite_rx=1"
at_fn_check_prepare_trace "system-dpdk.at:1008"
( $at_check_trace; ovs-vsctl add-port br0 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_pcap1,rx_pcap=fuzzy.pcap,infinite_rx=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1008"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1009: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:1009"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1009"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1011: ovs-appctl dpif-netdev/dpif-impl-set dpif_avx512"
at_fn_check_prepare_trace "system-dpdk.at:1011"
( $at_check_trace; ovs-appctl dpif-netdev/dpif-impl-set dpif_avx512
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "DPIF implementation set to dpif_avx512.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1011"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1015: ovs-appctl dpif-netdev/miniflow-parser-set autovalidator"
at_fn_check_prepare_trace "system-dpdk.at:1015"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set autovalidator
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to autovalidator.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1015"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


printf "%s\n" "system-dpdk.at:1019" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1019"
      printf "%s\n" "system-dpdk.at:1019" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1019"
   ovs_wait_cond () {
    test `ovs-vsctl get interface p1 statistics | grep -oP 'rx_packets=\s*\K\d+'` -ge 16000
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1019" "until test \`ovs-vsctl get interface p1 statistics | grep -oP 'rx_packets=\\s*\\K\\d+'\` -ge 16000"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1022: ovs-vsctl del-port br0 p1"
at_fn_check_prepare_trace "system-dpdk.at:1022"
( $at_check_trace; ovs-vsctl del-port br0 p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1022"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1023: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@upcall: datapath reached the dynamic limit of .* flows.@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:1023"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@upcall: datapath reached the dynamic limit of .* flows.@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1023: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:1023"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1023: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:1023"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1023" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1023"
      printf "%s\n" "system-dpdk.at:1023" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1023"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1023" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1023: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:1023"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1023: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:1023"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1023"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1023" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1023"
      printf "%s\n" "system-dpdk.at:1023" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1023"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1023" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_23
#AT_START_24
at_fn_group_banner 24 'system-dpdk.at:1030' \
  "OVS-DPDK - MFEX Configuration" "                  " 1
at_xfail=no
(
  printf "%s\n" "24. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1032: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:1032"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1032"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1032" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:1032"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1032: mount"
at_fn_check_prepare_trace "system-dpdk.at:1032"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1032"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1032: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:1032"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1032"
$at_failed && at_fn_log_failure
$at_traceon; }



printf "%s\n" "system-dpdk.at:1033" >"$at_check_line_file"
(! $PYTHON3 -c "import scapy") \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:1033"
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1034: \$PYTHON3 \$srcdir/mfex_fuzzy.py test_traffic.pcap 1"
at_fn_check_prepare_dynamic "$PYTHON3 $srcdir/mfex_fuzzy.py test_traffic.pcap 1" "system-dpdk.at:1034"
( $at_check_trace; $PYTHON3 $srcdir/mfex_fuzzy.py test_traffic.pcap 1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1034"
$at_failed && at_fn_log_failure
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:1035"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:1035"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:1035"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:1035"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:1035"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:1035"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }

      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:1035"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1035: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:1035"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1035"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1036: ovs-vsctl --no-wait set Open_vSwitch . other_config:pmd-cpu-mask=0x1"
at_fn_check_prepare_trace "system-dpdk.at:1036"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:pmd-cpu-mask=0x1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1036"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1038: ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:1038"
( $at_check_trace; ovs-vsctl add-br br0 -- set bridge br0 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1038"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1039: ovs-vsctl add-port br0 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_pcap1,rx_pcap=test_traffic.pcap,infinite_rx=1"
at_fn_check_prepare_trace "system-dpdk.at:1039"
( $at_check_trace; ovs-vsctl add-port br0 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_pcap1,rx_pcap=test_traffic.pcap,infinite_rx=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1039"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1040: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:1040"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1040"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1042: ovs-appctl dpif-netdev/miniflow-parser-set scalar 1"
at_fn_check_prepare_trace "system-dpdk.at:1042"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set scalar 1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: unknown argument 1.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1042"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1048: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 6 study 300 xyz"
at_fn_check_prepare_trace "system-dpdk.at:1048"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 6 study 300 xyz
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: invalid study_pkt_cnt value: xyz.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1048"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1054: ovs-appctl dpif-netdev/miniflow-parser-set scalar abcd"
at_fn_check_prepare_trace "system-dpdk.at:1054"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set scalar abcd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: unknown argument abcd.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1054"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1060: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 scalar abcd"
at_fn_check_prepare_trace "system-dpdk.at:1060"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 scalar abcd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: unknown argument abcd.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1060"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1066: ovs-appctl dpif-netdev/miniflow-parser-set -pmd"
at_fn_check_prepare_trace "system-dpdk.at:1066"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: -pmd option requires a thread id argument.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1066"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1072: ovs-appctl dpif-netdev/miniflow-parser-set tudy abcd"
at_fn_check_prepare_trace "system-dpdk.at:1072"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set tudy abcd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: unknown argument abcd.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1072"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1078: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 7 study abcd"
at_fn_check_prepare_trace "system-dpdk.at:1078"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 7 study abcd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: invalid study_pkt_cnt value: abcd.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1078"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1084: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 study"
at_fn_check_prepare_trace "system-dpdk.at:1084"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 study
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to study, on pmd thread 0, studying 128 packets.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1084"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1088: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 study 512"
at_fn_check_prepare_trace "system-dpdk.at:1088"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 study 512
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to study, on pmd thread 0, studying 512 packets.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1088"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1092: ovs-appctl dpif-netdev/miniflow-parser-set study 512"
at_fn_check_prepare_trace "system-dpdk.at:1092"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set study 512
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to study, studying 512 packets.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1092"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1096: ovs-appctl dpif-netdev/miniflow-parser-set study"
at_fn_check_prepare_trace "system-dpdk.at:1096"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set study
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to study, studying 128 packets.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1096"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1100: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 autovalidator"
at_fn_check_prepare_trace "system-dpdk.at:1100"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 0 autovalidator
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; printf "%s\n" "Miniflow extract implementation set to autovalidator, on pmd thread 0.
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1100"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1104: ovs-appctl dpif-netdev/miniflow-parser-set -pmd zero study"
at_fn_check_prepare_trace "system-dpdk.at:1104"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd zero study
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: miniflow extract parser not changed, PMD thread passed is not valid: 'zero'. Pass a valid pmd thread ID.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1104"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1110: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 1"
at_fn_check_prepare_trace "system-dpdk.at:1110"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: no miniflow extract name provided. Output of miniflow-parser-get shows implementation list.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1110"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1116: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 1 superstudy"
at_fn_check_prepare_trace "system-dpdk.at:1116"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 1 superstudy
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: unknown miniflow extract implementation superstudy.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1116"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1122: ovs-appctl dpif-netdev/miniflow-parser-set superstudy"
at_fn_check_prepare_trace "system-dpdk.at:1122"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set superstudy
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: unknown miniflow extract implementation superstudy.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1122"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1128: ovs-appctl dpif-netdev/miniflow-parser-set -pmd 1 study -pmd"
at_fn_check_prepare_trace "system-dpdk.at:1128"
( $at_check_trace; ovs-appctl dpif-netdev/miniflow-parser-set -pmd 1 study -pmd
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; printf "%s\n" "Error: invalid study_pkt_cnt value: -pmd.
ovs-appctl: ovs-vswitchd: server returned an error
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/system-dpdk.at:1128"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1135: ovs-vsctl del-port br0 p1"
at_fn_check_prepare_trace "system-dpdk.at:1135"
( $at_check_trace; ovs-vsctl del-port br0 p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1135"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1136: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\\@Error: unknown argument 1.@d
\\@Error: invalid study_pkt_cnt value: xyz.@d
\\@Error: unknown argument abcd.@d
\\@Error: -pmd option requires a thread id argument.@d
\\@Error: invalid study_pkt_cnt value: abcd.@d
\\@Error: miniflow extract parser not changed, PMD thread passed is not valid: 'zero'. Pass a valid pmd thread ID.@d
\\@Error: no miniflow extract name provided. Output of miniflow-parser-get shows implementation list.@d
\\@Error: unknown miniflow extract implementation superstudy.@d
\\@Error: invalid study_pkt_cnt value: -pmd.@d
\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:1136"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\@Error: unknown argument 1.@d
\@Error: invalid study_pkt_cnt value: xyz.@d
\@Error: unknown argument abcd.@d
\@Error: -pmd option requires a thread id argument.@d
\@Error: invalid study_pkt_cnt value: abcd.@d
\@Error: miniflow extract parser not changed, PMD thread passed is not valid: 'zero'. Pass a valid pmd thread ID.@d
\@Error: no miniflow extract name provided. Output of miniflow-parser-get shows implementation list.@d
\@Error: unknown miniflow extract implementation superstudy.@d
\@Error: invalid study_pkt_cnt value: -pmd.@d
"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1136: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:1136"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1136: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:1136"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1136" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1136"
      printf "%s\n" "system-dpdk.at:1136" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1136"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1136" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1136: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:1136"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1136: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:1136"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1136"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1136" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1136"
      printf "%s\n" "system-dpdk.at:1136" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1136"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1136" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_24
#AT_START_25
at_fn_group_banner 25 'system-dpdk.at:1152' \
  "OVS-DPDK - user configured mempool" "             " 1
at_xfail=no
(
  printf "%s\n" "25. $at_setup_line: testing $at_desc ..."
  $at_traceon

ovs_init


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1154: cat /proc/meminfo"
at_fn_check_prepare_trace "system-dpdk.at:1154"
( $at_check_trace; cat /proc/meminfo
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1154"
$at_failed && at_fn_log_failure
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1154" >"$at_check_line_file"
(grep -E 'HugePages_Free: *0' stdout) \
  && at_fn_check_skip 77 "$at_srcdir/system-dpdk.at:1154"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1154: mount"
at_fn_check_prepare_trace "system-dpdk.at:1154"
( $at_check_trace; mount
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1154"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1154: grep 'hugetlbfs' stdout"
at_fn_check_prepare_trace "system-dpdk.at:1154"
( $at_check_trace; grep 'hugetlbfs' stdout
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1154"
$at_failed && at_fn_log_failure
$at_traceon; }



   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1155: touch .conf.db.~lock~"
at_fn_check_prepare_trace "system-dpdk.at:1155"
( $at_check_trace; touch .conf.db.~lock~
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1155"
$at_failed && at_fn_log_failure
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1155: ovsdb-tool create conf.db \$abs_top_srcdir/vswitchd/vswitch.ovsschema"
at_fn_check_prepare_dynamic "ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema" "system-dpdk.at:1155"
( $at_check_trace; ovsdb-tool create conf.db $abs_top_srcdir/vswitchd/vswitch.ovsschema
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1155"
$at_failed && at_fn_log_failure
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1155: ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:\$OVS_RUNDIR/db.sock"
at_fn_check_prepare_dynamic "ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock" "system-dpdk.at:1155"
( $at_check_trace; ovsdb-server --detach --no-chdir --pidfile --log-file --remote=punix:$OVS_RUNDIR/db.sock
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1155"
$at_failed && at_fn_log_failure
$at_traceon; }

   on_exit "kill `cat ovsdb-server.pid`"
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1155: sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'"
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:1155"
( $at_check_trace; sed < stderr '
/vlog|INFO|opened log file/d
/ovsdb_server|INFO|ovsdb-server (Open vSwitch)/d'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1155"
$at_failed && at_fn_log_failure
$at_traceon; }



      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1155: ovs-vsctl --no-wait init"
at_fn_check_prepare_trace "system-dpdk.at:1155"
( $at_check_trace; ovs-vsctl --no-wait init
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1155"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1156: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra=\"--log-level=pmd.*:error --no-pci\""
at_fn_check_prepare_trace "system-dpdk.at:1156"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-extra="--log-level=pmd.*:error --no-pci"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1156"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


      { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1156: ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl"
at_fn_check_prepare_trace "system-dpdk.at:1156"
( $at_check_trace; ovs-vswitchd --detach --no-chdir --pidfile --log-file -vvconn -vofproto_dpif -vunixctl
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1156"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log"
$at_traceon; }


   on_exit "kill_ovs_vswitchd `cat ovs-vswitchd.pid`"


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1158: ovs-vsctl --no-wait set Open_vSwitch . other_config:shared-mempool-config=8000,6000,1500"
at_fn_check_prepare_trace "system-dpdk.at:1158"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:shared-mempool-config=8000,6000,1500
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1158"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1159: ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true"
at_fn_check_prepare_trace "system-dpdk.at:1159"
( $at_check_trace; ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1159"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }



    line_st=
    if [ -z "$line_st" ]
    then
        line_st="+0"
    fi
    printf "%s\n" "system-dpdk.at:1161" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1161"
      printf "%s\n" "system-dpdk.at:1161" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1161"
   ovs_wait_cond () {
    tail -n $line_st ovs-vswitchd.log                    | grep "User configured shared mempool set for: MTU 8000, NUMA ALL."
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1161" "until tail -n \$line_st ovs-vswitchd.log                    | grep \"User configured shared mempool set for: MTU 8000, NUMA ALL.\""



    line_st=
    if [ -z "$line_st" ]
    then
        line_st="+0"
    fi
    printf "%s\n" "system-dpdk.at:1162" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1162"
      printf "%s\n" "system-dpdk.at:1162" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1162"
   ovs_wait_cond () {
    tail -n $line_st ovs-vswitchd.log                    | grep "User configured shared mempool set for: MTU 6000, NUMA ALL."
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1162" "until tail -n \$line_st ovs-vswitchd.log                    | grep \"User configured shared mempool set for: MTU 6000, NUMA ALL.\""



    line_st=
    if [ -z "$line_st" ]
    then
        line_st="+0"
    fi
    printf "%s\n" "system-dpdk.at:1163" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1163"
      printf "%s\n" "system-dpdk.at:1163" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1163"
   ovs_wait_cond () {
    tail -n $line_st ovs-vswitchd.log                    | grep "User configured shared mempool set for: MTU 1500, NUMA ALL."
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1163" "until tail -n \$line_st ovs-vswitchd.log                    | grep \"User configured shared mempool set for: MTU 1500, NUMA ALL.\""



{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1165: ovs-appctl vlog/set netdev_dpdk:dbg"
at_fn_check_prepare_trace "system-dpdk.at:1165"
( $at_check_trace; ovs-appctl vlog/set netdev_dpdk:dbg
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1165"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1168: ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev"
at_fn_check_prepare_trace "system-dpdk.at:1168"
( $at_check_trace; ovs-vsctl add-br br10 -- set bridge br10 datapath_type=netdev
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1168"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1169: ovs-vsctl add-port br10 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_null0,no-rx=1"
at_fn_check_prepare_trace "system-dpdk.at:1169"
( $at_check_trace; ovs-vsctl add-port br10 p1 -- set Interface p1 type=dpdk options:dpdk-devargs=net_null0,no-rx=1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1169"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1170: ovs-vsctl show"
at_fn_check_prepare_trace "system-dpdk.at:1170"
( $at_check_trace; ovs-vsctl show
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1170"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

sleep 2

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1174: grep \"Found user configured shared mempool .* suitable for port with MTU 1500\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:1174"
( $at_check_trace; grep "Found user configured shared mempool .* suitable for port with MTU 1500" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1174"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1175: grep \"Port p1: Requesting a mempool\" ovs-vswitchd.log"
at_fn_check_prepare_trace "system-dpdk.at:1175"
( $at_check_trace; grep "Port p1: Requesting a mempool" ovs-vswitchd.log
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1175"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }


TMP=$(($(cat ovs-vswitchd.log | wc -l | tr -d [:blank:])+1))
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1179: ovs-vsctl set Interface p1 mtu_request=7000"
at_fn_check_prepare_trace "system-dpdk.at:1179"
( $at_check_trace; ovs-vsctl set Interface p1 mtu_request=7000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1179"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:1180" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1180"
      printf "%s\n" "system-dpdk.at:1180" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1180"
   ovs_wait_cond () {
    tail -n +$TMP ovs-vswitchd.log | grep "Found user configured shared mempool .* suitable for port with MTU 7000"
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1180" "until tail -n +\$TMP ovs-vswitchd.log | grep \"Found user configured shared mempool .* suitable for port with MTU 7000\""

printf "%s\n" "system-dpdk.at:1181" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1181"
      printf "%s\n" "system-dpdk.at:1181" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1181"
   ovs_wait_cond () {
    tail -n +$TMP ovs-vswitchd.log | grep "Port p1: Requesting a mempool"
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1181" "until tail -n +\$TMP ovs-vswitchd.log | grep \"Port p1: Requesting a mempool\""


TMP=$(($(cat ovs-vswitchd.log | wc -l | tr -d [:blank:])+1))
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1185: ovs-vsctl set Interface p1 mtu_request=1500"
at_fn_check_prepare_trace "system-dpdk.at:1185"
( $at_check_trace; ovs-vsctl set Interface p1 mtu_request=1500
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1185"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:1186" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1186"
      printf "%s\n" "system-dpdk.at:1186" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1186"
   ovs_wait_cond () {
    tail -n +$TMP ovs-vswitchd.log | grep "Found user configured shared mempool .* suitable for port with MTU 1500"
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1186" "until tail -n +\$TMP ovs-vswitchd.log | grep \"Found user configured shared mempool .* suitable for port with MTU 1500\""

printf "%s\n" "system-dpdk.at:1187" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1187"
      printf "%s\n" "system-dpdk.at:1187" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1187"
   ovs_wait_cond () {
    tail -n +$TMP ovs-vswitchd.log | grep "Reusing mempool"
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1187" "until tail -n +\$TMP ovs-vswitchd.log | grep \"Reusing mempool\""


TMP=$(($(cat ovs-vswitchd.log | wc -l | tr -d [:blank:])+1))
{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1191: ovs-vsctl set Interface p1 mtu_request=9000"
at_fn_check_prepare_trace "system-dpdk.at:1191"
( $at_check_trace; ovs-vsctl set Interface p1 mtu_request=9000
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1191"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

printf "%s\n" "system-dpdk.at:1192" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1192"
      printf "%s\n" "system-dpdk.at:1192" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1192"
   ovs_wait_cond () {
    tail -n +$TMP ovs-vswitchd.log | grep "No user configured shared mempool mbuf sizes found suitable for port with MTU 9000"
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1192" "until tail -n +\$TMP ovs-vswitchd.log | grep \"No user configured shared mempool mbuf sizes found suitable for port with MTU 9000\""

printf "%s\n" "system-dpdk.at:1193" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1193"
      printf "%s\n" "system-dpdk.at:1193" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1193"
   ovs_wait_cond () {
    tail -n +$TMP ovs-vswitchd.log | grep "Port p1: Requesting a mempool"
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1193" "until tail -n +\$TMP ovs-vswitchd.log | grep \"Port p1: Requesting a mempool\""


{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1196: ovs-vsctl del-port br10 p1"
at_fn_check_prepare_trace "system-dpdk.at:1196"
( $at_check_trace; ovs-vsctl del-port br10 p1
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; tee stderr <"$at_stderr"
echo stdout:; tee stdout <"$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1196"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

{ set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1197: check_logs \"
\\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\\@does not support MTU configuration,@d
\\@EAL: No \\(available\\|free\\) .*hugepages reported@d
\\@Failed to enable flow control@d
\\@Rx checksum offload is not supported on@d
\\@TELEMETRY: No legacy callbacks, legacy socket not created@d

\""
at_fn_check_prepare_notrace 'an embedded newline' "system-dpdk.at:1197"
( $at_check_trace; check_logs "
\@does not exist. The Open vSwitch kernel module is probably not loaded.@d
\@does not support MTU configuration,@d
\@EAL: No \(available\|free\) .*hugepages reported@d
\@Failed to enable flow control@d
\@Rx checksum offload is not supported on@d
\@TELEMETRY: No legacy callbacks, legacy socket not created@d

"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1197: test -e \$OVS_RUNDIR/ovs-vswitchd.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovs-vswitchd.pid" "system-dpdk.at:1197"
( $at_check_trace; test -e $OVS_RUNDIR/ovs-vswitchd.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovs-vswitchd.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1197: ovs-appctl -t ovs-vswitchd exit --cleanup"
at_fn_check_prepare_trace "system-dpdk.at:1197"
( $at_check_trace; ovs-appctl -t ovs-vswitchd exit --cleanup
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1197" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1197"
      printf "%s\n" "system-dpdk.at:1197" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1197"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1197" "while kill -0 \$TMPPID 2>/dev/null"

   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1197: test -e \$OVS_RUNDIR/ovsdb-server.pid"
at_fn_check_prepare_dynamic "test -e $OVS_RUNDIR/ovsdb-server.pid" "system-dpdk.at:1197"
( $at_check_trace; test -e $OVS_RUNDIR/ovsdb-server.pid
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   TMPPID=$(cat $OVS_RUNDIR/ovsdb-server.pid)
   { set +x
printf "%s\n" "$at_srcdir/system-dpdk.at:1197: ovs-appctl -t ovsdb-server exit"
at_fn_check_prepare_trace "system-dpdk.at:1197"
( $at_check_trace; ovs-appctl -t ovsdb-server exit
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/system-dpdk.at:1197"
$at_failed && at_fn_log_failure  \
"ovsdb-server.log" \
"ovs-vswitchd.log"
$at_traceon; }

   printf "%s\n" "system-dpdk.at:1197" >"$at_check_line_file"
(test "1" -ge 3) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1197"
      printf "%s\n" "system-dpdk.at:1197" >"$at_check_line_file"
(test "1" -eq 2 && test "" -eq "" 2>/dev/null) \
  && at_fn_check_skip 99 "$at_srcdir/system-dpdk.at:1197"
   ovs_wait_cond () {
    if kill -0 $TMPPID 2>/dev/null; then return 1; else return 0; fi
}
ovs_wait_failed () {
    :

}
ovs_wait "system-dpdk.at:1197" "while kill -0 \$TMPPID 2>/dev/null"

ovs_cleanup
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_25
